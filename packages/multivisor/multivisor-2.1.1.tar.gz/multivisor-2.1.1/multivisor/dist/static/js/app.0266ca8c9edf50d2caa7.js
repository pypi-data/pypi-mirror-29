webpackJsonp([1],{"7zck":function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("/5sW"),r=s("Dd8w"),n=s.n(r),i=s("NYxO"),a=function(t,e){var s=new FormData;s.append("uid",t),fetch("/process/"+e,{method:"POST",body:s})},c=function(t,e){if(0===t)return"0 b";var s=e||2,o=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,o)).toFixed(s))+" "+["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"][o]},l={name:"LogSheet",props:["visible","source"],data:function(){return{text:"",size:0,maximize:!1,autoScroll:!0,eventSource:null}},watch:{visible:function(t){this.viewLog(t)}},computed:{title:function(){return this.source.visible?(console.log(this.source.visible),("out"===this.source.stream?"O-log of ":"E-log of ")+"\n      "+this.source.process.name+" on "+this.source.process.supervisor):""},windowSize:function(){var t=window.innerHeight;return"height: "+(this.maximize?t-80:Math.min(t/3,300))+"px;"},sizeStr:function(){return c(this.size)},localSizeStr:function(){return c(this.text.length)},active:function(){return this.eventSource&&this.eventSource.readyState<2}},methods:{appendLogMessage:function(t){if(this.size=t.size,t.message&&(this.text+=t.message,this.text.length>1e7&&(this.text=this.text.substr(-9e6))),this.autoScroll){var e=document.getElementById("logContent");setTimeout(function(){e.scrollTop=e.scrollHeight},100)}},viewLog:function(t){var e=this;if(null!==this.eventSource&&(this.text="",this.size=0,this.eventSource.close()),t){var s=this.source.stream,o=this.source.process.uid,r=new EventSource("/process/log/"+s+"/tail/"+o);r.onmessage=function(t){var s=JSON.parse(t.data);e.appendLogMessage(s)},r.onopen=function(t){console.log(s+" stream opened for "+o)},r.onclose=function(t){e.eventSource=null},r.onerror=function(t){e.eventSource.close(),e.eventSource=null},this.eventSource=r}}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-toolbar",{attrs:{dense:"",height:"32px",color:"err"===t.source.stream?"orange":"blue"}},[s("h5",[t._v(t._s(t.title))]),t._v(" "),s("v-spacer"),t._v(" "),s("v-tooltip",{attrs:{bottom:""}},[s("v-switch",{staticStyle:{height:"32px"},attrs:{slot:"activator",color:"indigo"},slot:"activator",model:{value:t.autoScroll,callback:function(e){t.autoScroll=e},expression:"autoScroll"}}),t._v(" "),s("span",[t._v("auto-scroll ("+t._s(t.autoScroll?"On":"Off")+")")])],1),t._v(" "),s("v-tooltip",{attrs:{bottom:""}},[s("v-chip",{attrs:{slot:"activator",color:"indigo white--text",dark:""},slot:"activator"},[t._v("\n        "+t._s(t.localSizeStr)+"\n        "),s("v-btn",{staticClass:"ml-0",attrs:{icon:"",small:"",left:""},on:{click:function(e){t.text=""}}},[s("v-icon",[t._v("delete")])],1)],1),t._v(" "),s("span",[t._v("Web console log size")])],1),t._v(" "),s("v-tooltip",{attrs:{bottom:""}},[s("v-chip",{staticClass:"indigo white--text",attrs:{slot:"activator",dark:""},slot:"activator"},[t._v("\n        "+t._s(t.sizeStr)+"\n      ")]),t._v(" "),s("span",[t._v("Remote log size")])],1),t._v(" "),s("v-btn",{staticClass:"mr-2",attrs:{icon:"",dark:"",small:""},on:{click:function(e){t.maximize=!t.maximize}}},[t.maximize?s("v-icon",[t._v("expand_more")]):s("v-icon",[t._v("expand_less")])],1)],1),t._v(" "),s("v-progress-linear",{staticClass:"my-0",attrs:{indeterminate:t.active,height:"1","background-color":"white",color:"deep-purple"}}),t._v(" "),s("v-card",[s("v-card-text",{staticClass:"scroll-y black white--text px-2 py-0",style:t.windowSize,attrs:{id:"logContent"}},[s("pre",{staticClass:"logConsole "},[t._v("        "+t._s(t.text)+"\n      ")])])],1)],1)},staticRenderFns:[]};var v={name:"ProcessDetails",props:["process"],computed:{startTime:function(){return Date(this.process.start)},lastUpdate:function(){return t=this.process.now,e={prefix:"",suffix:" ago",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years"},s=function(t,s){return e[t]&&e[t].replace(/%d/i,Math.abs(Math.round(s)))},o=new Date(1e3*t),r=.001*((new Date).getTime()-o)>>0,c=(a=(i=(n=r/60)/60)/24)/365,e.prefix+(r<45&&s("seconds",r)||r<90&&s("minute",1)||n<45&&s("minutes",n)||n<90&&s("hour",1)||i<24&&s("hours",i)||i<42&&s("day",1)||a<30&&s("days",a)||a<45&&s("month",1)||a<365&&s("months",a/30)||c<1.5&&s("year",1)||s("years",c))+e.suffix;var t,e,s,o,r,n,i,a,c}}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-card-text",[s("i",[t._v("Last updated: "+t._s(t.lastUpdate))]),s("br"),t._v("\n    Host:"),s("b",[t._v(t._s(t.process.host))]),s("br"),t._v("\n    PID:"),s("b",[t._v(t._s(t.process.pid))]),s("br"),t._v("\n    Started at:"),s("b",[t._v(t._s(t.startTime))]),s("br"),t._v("\n    Details:"),s("b",[t._v(t._s(t.process.description))]),s("br"),t._v("\n    Last exit status:"),s("b",[t._v(t._s(t.process.exitstatus))]),s("br"),t._v(" "),t.process.logfile?[t._v("\n      Log:"),s("b",[t._v(t._s(t.process.logfile))]),s("br")]:t._e(),t._v(" "),t.process.stderr_logfile?[t._v("\n      Err log:"),s("b",[t._v(t._s(t.process.stderr_logfile))]),s("br")]:t._e()],2)],1)},staticRenderFns:[]},p={components:{LogSheet:s("VU/8")(l,u,!1,function(t){s("jEC6")},"data-v-212919d8",null).exports,ProcessDetails:s("VU/8")(v,d,!1,null,null,null).exports},data:function(){return{stateColorMap:{STOPPED:"grey",STARTING:"blue",RUNNING:"green",BACKOFF:"orange",STOPPING:"blue",EXITED:"orange",FATAL:"red",UNKNOWN:"black"},notificationMap:{DEBUG:"grey darken-2",INFO:"grey darken-3",WARNING:"orange",ERROR:"error"},logSource:{process:null,visible:!1,stream:"out"},processHeaders:[{align:"left",sortable:!0,text:"Group",value:"group",tooltip:"process group",class:"hidden-xs-only"},{align:"left",sortable:!0,text:"Name",value:"name",tooltip:"process name"},{align:"left",sortable:!0,text:"Supervisor",value:"supervisor",tooltip:"supervisor controlling proces",class:"hidden-xs-only"},{align:"left",sortable:!0,text:"State",value:"statename",tooltip:"process state"},{align:"left",sortable:!1,text:"Actions",value:"",tooltip:"(re)start/stop/view log"}],searchProcesses:"",selectedProcesses:[],snackbar:{visible:!1,color:"info"}}},watch:{lastNotification:function(t){this.snackbar.visible=!0,this.snackbar.color=this.notificationMap[t.level]}},methods:{restartProcess:function(t){this.$store.dispatch("restartProcesses",[t.uid])},stopProcess:function(t){this.$store.dispatch("stopProcesses",[t.uid])},restartSelected:function(){var t=this.selectedProcesses.map(function(t){return t.uid});this.$store.dispatch("restartProcesses",t),this.selectedProcesses=[]},stopSelected:function(){var t=this.selectedProcesses.map(function(t){return t.uid});this.$store.dispatch("stopProcesses",t),this.selectedProcesses=[]},viewLog:function(t,e){this.logSource={process:t,stream:e,visible:!0}}},computed:n()({},Object(i.b)(["nbRunningProcesses","nbStoppedProcesses","totalNbProcesses","nbRunningSupervisors","nbStoppedSupervisors","totalNbSupervisors"]),{name:function(){return this.$store.state.multivisor.name},lastNotification:function(){var t=this.$store.state.notifications.length;return t?this.$store.state.notifications[t-1]:{message:""}},processes:function(){return this.$store.getters.loadedProcesses}})},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-app",[s("v-toolbar",{staticClass:"primary",attrs:{fixed:"",dense:"",dark:"",app:""}},[s("v-toolbar-title",{staticClass:"hidden-xs-only"},[t._v(t._s(t.name))]),t._v(" "),s("v-spacer",{staticClass:"hidden-xs-only"}),t._v(" "),s("v-toolbar-items",[s("v-tooltip",{attrs:{bottom:""}},[s("v-btn",{attrs:{slot:"activator",icon:"",disabled:!t.selectedProcesses.length},on:{click:function(e){t.restartSelected()}},slot:"activator"},[s("v-icon",{attrs:{large:"",color:"green darken-1"}},[t._v("autorenew")])],1),t._v(" "),s("span",[t._v("(Re)start selected processes")])],1),t._v(" "),s("v-tooltip",{attrs:{bottom:""}},[s("v-btn",{attrs:{slot:"activator",icon:"",disabled:!t.selectedProcesses.length},on:{click:function(e){t.stopSelected()}},slot:"activator"},[s("v-icon",{attrs:{large:"",color:"red darken-4"}},[t._v("stop")])],1),t._v(" "),s("span",[t._v("Stop selected processes")])],1),t._v(" "),s("v-text-field",{staticClass:"mx-3 mt-2",attrs:{"append-icon":"search",color:"grey lighten-1",clearable:"","single-line":"",placeholder:"Filter..."},model:{value:t.searchProcesses,callback:function(e){t.searchProcesses=e},expression:"searchProcesses"}}),t._v(" "),s("v-chip",{staticClass:"deep-purple darken-2 white--text mx-2 hidden-xs-only"},[s("v-tooltip",{attrs:{bottom:""}},[s("v-avatar",{staticClass:"deep-purple lighten-1",attrs:{slot:"activator"},slot:"activator"},[s("v-icon",[t._v("settings")])],1),t._v(" "),s("span",[t._v("Processes")])],1),t._v(" "),s("v-icon",{staticClass:"mr-2"},[t._v("thumb_up")]),t._v("\n      "+t._s(t.nbRunningProcesses)+"\n      "),s("v-icon",{staticClass:"mx-2"},[t._v("thumb_down")]),t._v("\n      "+t._s(t.nbStoppedProcesses)+"\n    ")],1),t._v(" "),s("v-chip",{staticClass:"indigo darken-2 white--text mx-2 hidden-xs-only"},[s("v-tooltip",{attrs:{bottom:""}},[s("v-avatar",{staticClass:"indigo lighten-1",attrs:{slot:"activator"},slot:"activator"},[s("v-icon",[t._v("visibility")])],1),t._v(" "),s("span",[t._v("Supervisors")])],1),t._v(" "),s("v-icon",{staticClass:"mr-2"},[t._v("thumb_up")]),t._v("\n      "+t._s(t.nbRunningSupervisors)+"\n      "),s("v-icon",{staticClass:"mx-2"},[t._v("thumb_down")]),t._v("\n      "+t._s(t.nbStoppedSupervisors)+"\n    ")],1)],1)],1),t._v(" "),s("v-content",[s("v-container",{attrs:{fluid:""}},[s("v-layout",{attrs:{"justify-center":""}},[s("v-card",[s("v-data-table",{staticClass:"elevation-4",attrs:{headers:t.processHeaders,items:t.processes,search:t.searchProcesses,"hide-actions":"","select-all":"","item-key":"uid"},scopedSlots:t._u([{key:"headerCell",fn:function(e){return[s("v-tooltip",{attrs:{bottom:""}},[s("span",{attrs:{slot:"activator"},slot:"activator"},[t._v("\n                "+t._s(e.header.text)+"\n              ")]),t._v(" "),s("span",[t._v("\n                "+t._s(e.header.tooltip)+"\n              ")])])]}},{key:"items",fn:function(e){return[s("tr",[s("td",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:e.selected,callback:function(s){t.$set(e,"selected",s)},expression:"props.selected"}})],1),t._v(" "),s("td",{staticClass:"hidden-xs-only px-0",staticStyle:{cursor:"pointer",height:"30px"},on:{click:function(t){e.expanded=!e.expanded}}},[t._v("\n                  "+t._s(e.item.group)+"\n              ")]),t._v(" "),s("td",{staticClass:"px-0",staticStyle:{cursor:"pointer",height:"30px"},on:{click:function(t){e.expanded=!e.expanded}}},[t._v("\n                  "+t._s(e.item.name)+"\n              ")]),t._v(" "),s("td",{staticClass:"hidden-xs-only px-0",staticStyle:{height:"30px"}},[t._v("\n                "+t._s(e.item.supervisor)+"\n              ")]),t._v(" "),s("td",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-chip",{attrs:{disabled:"",label:"",color:t.stateColorMap[e.item.statename],"text-color":"white",small:""}},[t._v("\n                        "+t._s(e.item.statename)+"\n                ")])],1),t._v(" "),s("td",{staticClass:"layout px-0",staticStyle:{height:"30px"}},[s("v-btn",{staticClass:"mx-0 my-1",attrs:{icon:"",small:""},on:{click:function(s){t.restartProcess(e.item)}}},[s("v-icon",{attrs:{color:"green"}},[e.item.running?[t._v("autorenew")]:[t._v("play_arrow")]],2)],1),t._v(" "),s("v-btn",{staticClass:"mx-0 my-1",attrs:{icon:"",small:"",disabled:!e.item.running},on:{click:function(s){t.stopProcess(e.item)}}},[s("v-icon",{attrs:{color:"red"}},[t._v("stop")])],1),t._v(" "),s("v-menu",{attrs:{"open-on-hover":"",auto:""}},[s("v-btn",{staticClass:"mx-0 my-1",attrs:{slot:"activator",icon:"",small:"",dark:"",color:"blue--text"},slot:"activator"},[s("v-icon",[t._v("more_vert")])],1),t._v(" "),s("div",{staticClass:"grey lighten-3"},[e.item.logfile?s("v-btn",{attrs:{icon:"",small:""},on:{click:function(s){t.viewLog(e.item,"out")}}},[s("v-icon",{attrs:{color:"blue"}},[t._v("description")])],1):t._e(),t._v(" "),e.item.stderr_logfile?s("v-btn",{attrs:{icon:"",small:""},on:{click:function(s){t.viewLog(e.item,"err")}}},[s("v-icon",{attrs:{color:"orange"}},[t._v("description")])],1):t._e()],1)],1)],1)])]}},{key:"expand",fn:function(t){return[s("v-card",{attrs:{flat:""}},[s("v-card-text",[s("ProcessDetails",{attrs:{process:t.item}})],1)],1)]}}]),model:{value:t.selectedProcesses,callback:function(e){t.selectedProcesses=e},expression:"selectedProcesses"}},[s("template",{slot:"no-data"},[s("div",[t._v("Sorry, there are no processes currently being monitored")])]),t._v(" "),s("template",{slot:"no-results"},[s("div",[t._v("Sorry, no matching processes found")])])],2)],1)],1)],1)],1),t._v(" "),s("v-snackbar",{attrs:{timeout:5e3,bottom:"",right:"",color:t.snackbar.color},model:{value:t.snackbar.visible,callback:function(e){t.$set(t.snackbar,"visible",e)},expression:"snackbar.visible"}},[t._v("\n    "+t._s(t.lastNotification.message)+"\n  ")]),t._v(" "),s("v-bottom-sheet",{model:{value:t.logSource.visible,callback:function(e){t.$set(t.logSource,"visible",e)},expression:"logSource.visible"}},[s("LogSheet",{attrs:{visible:t.logSource.visible,source:t.logSource},on:{"update:visible":function(e){t.$set(t.logSource,"visible",e)}}})],1)],1)},staticRenderFns:[]},m=s("VU/8")(p,h,!1,null,null,null).exports,_=s("Gu7T"),f=s.n(_),b=s("gRE1"),g=s.n(b);o.a.use(i.a);var x=new i.a.Store({state:{multivisor:{name:"Multivisor",supervisors:{}},user:{id:"admin",role:"administrator"},notifications:[]},mutations:{setMultivisor:function(t,e){t.multivisor=e},setProcess:function(t,e){t.multivisor.supervisors[e.supervisor].processes[e.uid]=e},setSupervisor:function(t,e){t.multivisor.supervisors[e.name]=e},appendNotification:function(t,e){t.notifications.push(e)}},actions:{init:function(t){var e=t.commit;fetch("data").then(function(t){return t.json()}).then(function(t){e("setMultivisor",t);!function(t){var e=new EventSource("/stream");e.onmessage=function(e){var s=JSON.parse(e.data);t(s)}}(function(t){"process_changed"===t.event?e("setProcess",t.payload):"supervisor_changed"===t.event?e("setSupervisor",t.payload):"notification"===t.event&&e("appendNotification",t.payload)})})},restartProcesses:function(t,e){a(e,"restart")},stopProcesses:function(t,e){a(e,"stop")}},getters:{loadedSupervisors:function(t){return g()(t.multivisor.supervisors)},loadedProcesses:function(t,e){return e.loadedSupervisors.reduce(function(t,e){return t.push.apply(t,f()(g()(e.processes))),t},[])},loadedProcess:function(t){return function(e){return t.loadedProcesses.find(function(t){return t.uid===e})}},totalNbProcesses:function(t,e){return e.loadedProcesses.length},nbRunningProcesses:function(t,e){return e.loadedProcesses.reduce(function(t,e){return e.running?t+1:t},0)},nbStoppedProcesses:function(t,e){return e.totalNbProcesses-e.nbRunningProcesses},totalNbSupervisors:function(t,e){return e.loadedSupervisors.length},nbRunningSupervisors:function(t,e){return e.loadedSupervisors.reduce(function(t,e){return e.running?t+1:t},0)},nbStoppedSupervisors:function(t,e){return e.totalNbSupervisors-e.nbRunningSupervisors}}}),S=s("3EgV"),y=s.n(S);s("7zck");o.a.use(y.a),o.a.config.productionTip=!1,new o.a({el:"#app",store:x,render:function(t){return t(m)},created:function(){this.$store.dispatch("init")}})},jEC6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.0266ca8c9edf50d2caa7.js.map