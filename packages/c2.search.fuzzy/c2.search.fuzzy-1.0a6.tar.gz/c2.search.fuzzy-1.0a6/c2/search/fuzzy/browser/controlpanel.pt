<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      i18n:domain="c2.search.fuzzy">
<metal:block metal:fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border', 1)" />
<body>
<div metal:fill-slot="prefs_configlet_main">

    <div metal:use-macro="context/global_statusmessage/macros/portal_message">
        Portal status message
    </div>

    <h1 class="documentFirstHeading">
        Fuzzy Search Settings
    </h1>
    <h2>
        Base Fuzzy search
    </h2>
    <div>
        <h3>Rebuild</h3>
        <form name="reindex_form" method="post"
              action=""
              tal:attributes="action string:${context/absolute_url}/@@fuzzy-search-controlpanel">
            <p class="discreet">
                Rebuild for fuzzy search index data.
                You have many time for rebuild (about 10min), if you have over 1000 contents.
            </p>
            <input type="hidden" name="form.submit.rebuild" value="1" />
            <input type="submit" value="Rebuild" />
        </form>
    </div>

    <div>
        <h3>Number of words</h3>
            <p class="discreet">
                Index data for fuzzy search.
            </p>
        <p>Words count: <span tal:content="view/count">1230</span></p>
    </div>

    <div>
        <h3>Check page</h3>
        <p><a href="" tal:attributes="href string:${portal_url}/@@fuzzy-search">Tool check page</a></p>
    </div>

    <h2>
        SQL Fuzzy search if you needed
    </h2>
    <div tal:condition="view/use_sql_db"
        tal:define="db_statuses view/chk_db_talbe">
        <h3>SQL setting</h3>
        <div tal:condition="not: db_statuses/db_status">
            <p class="discreet">
                Beforer `saconnect` setting for DB connection id: `c2fuzzysqldb`.
            </p>
        </div>
        <div tal:condition="python: db_statuses['db_status'] and not db_statuses['db_session']">
            <form name="sql_create_db_form" method="post"
                  action=""
                  tal:attributes="action string:${context/absolute_url}/@@fuzzy-search-controlpanel">
                <p class="discreet">
                    Create for fuzzy search index SQL DB.
                </p>
                <input type="hidden" name="form.submit.createdb" value="1" />
                <input type="submit" value="Create" />
            </form>
        </div>
        <div tal:condition="db_statuses/db_session">
            <p class="discreet">
                SQL DB already created, DB connection id: `c2fuzzysqldb`.
                You can check `saconnect` setting, if needed.
            </p>
        </div>
    </div>
    <div tal:condition="not: view/use_sql_db">
        Nothing installed SQLAlchemy and more
    </div>
</div>

</body>

</html>