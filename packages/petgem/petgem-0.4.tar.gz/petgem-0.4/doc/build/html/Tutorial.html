
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial &#8212; PETGEM 1.01 documentation</title>
    <link rel="stylesheet" href="_static/petgem.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Manual" href="Manual.html" />
    <link rel="prev" title="Installation" href="Installation.html" /> 
  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  <a href="index.html"><img style="vertical-align: middle" src="_static/figures/petgem_logo.png" border="0" height="80px" alt="PETGEM"/></a>
    <a href="index.html"><strong><font color="#355f7c"> Parallel Edge-based Tool for Geophysical Electromagnetic Modelling</font></strong></a>
  <a href="http://www.bsc.es/"><img src="_static/figures/logo_bsc.jpeg" align="right" border="0" height="80px" alt="BSC"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Manual.html" title="Manual"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="WhatIs.html">What is PETGEM?</a>|&nbsp;</li>
        <li><a href="Features.html">Features</a>|&nbsp;</li>
        <li><a href="CSEMEdges.html">CSEM FM modelling</a>|&nbsp;</li>
        <li><a href="Installation.html">Installation</a>|&nbsp;</li>
        <li><a href="#">Tutorial</a>|&nbsp;</li>
        <li><a href="Manual.html">Manual</a>|&nbsp;</li>
        <li><a href="Publications.html">Publications</a>|&nbsp;</li>
	      <li><a href="Download.html">Download</a>|&nbsp;</li>
        <li><a href="Contact.html">Contact</a></li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="Installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Manual.html"
                        title="next chapter">Manual</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The PETGEM tutorial contains a small collection of programs which demonstrate
main aspects of the PETGEM work-flow. Each example has the
following structure:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">Readme.txt</span></code>. Short description about what the example does.</li>
<li><code class="docutils literal"><span class="pre">Input_preprocessing</span></code>. The input data of the 3D CSEM modelling of the program (file mesh and receivers positions file).</li>
<li><code class="docutils literal"><span class="pre">preprocessingParams.py</span></code>. Parameters for pre-processing stage.</li>
<li><code class="docutils literal"><span class="pre">modelParams.py</span></code>. Physical parameters for the 3D CSEM survey.</li>
<li><code class="docutils literal"><span class="pre">petsc.opts</span></code>. Parameters for <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> solvers.</li>
</ol>
<p>The data for simple cases modelling are freely available in the
<a class="reference internal" href="Download.html#download"><span class="std std-ref">Download</span></a> section.</p>
<div class="section" id="basic-notions">
<span id="id2"></span><h2>Basic notions<a class="headerlink" href="#basic-notions" title="Permalink to this headline">¶</a></h2>
<p>The use of PETGEM can be summarized in three steps: pre-processing, modelling and
post-processing. The pre-processing and modelling phases requires parameter files
where the physical conditions of the 3D CSEM model are defined. In such files,
also referred to as <code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> (pre-processing) and
<code class="docutils literal"><span class="pre">modelParams.py</span></code> (modelling), the 3D CSEM survey is described using several keywords
that allow one to define the main physical parameters and necessary file
locations. In sake of simplicity and in order to avoid a specific parser, the
<code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> and <code class="docutils literal"><span class="pre">modelParams.py</span></code> files are defined as Python
dictionaries. Furthermore, the syntax of the <code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> and
<code class="docutils literal"><span class="pre">modelParams.py</span></code> files is very simple yet powerful. As consequence, the
dictionary names and his key names MUST NOT BE changed. See Preprocessing
parameters file description and Modelling parameters file description
in <a class="reference internal" href="Manual.html#manual"><span class="std std-ref">Manual</span></a> section for a full explanation of those keywords.</p>
<p>For a general 3D CSEM survey, the PETGEM work-flow can be summarize as follows:</p>
<ol class="arabic simple">
<li>Following the contents of the <code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> file, a set of data are preprocessed (mesh, conductivity model and receivers positions)</li>
<li>The kernel (<code class="docutils literal"><span class="pre">kernel.py</span></code>) reads a <code class="docutils literal"><span class="pre">modelParams.py</span></code></li>
<li>Following the contents of the <code class="docutils literal"><span class="pre">modelParams.py</span></code>, a problem instance is created</li>
<li>The problem sets up its domain, sub-domains, source, solver. This stage include the computation of the main data structures</li>
<li>Parallel assembling of <img class="math" src="_images/math/d275af031e98b6eb55e1438bf891a34a840441f7.png" alt="Ax=b"/>. See <a class="reference internal" href="CSEMEdges.html#csem-problem"><span class="std std-ref">CSEM problem</span></a> and <a class="reference internal" href="CSEMEdges.html#edge-finite-element-formulation"><span class="std std-ref">Edge finite element formulation</span></a> sections for a detail mathematical background of this equation system</li>
<li>The solution is obtained in parallel by calling a <code class="docutils literal"><span class="pre">ksp()</span></code> <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> object.</li>
<li>Interpolation of electromagnetic responses &amp; post-processing parallel stage</li>
<li>Finally the solution can be stored by calling <code class="docutils literal"><span class="pre">postProcessingFields()</span></code> function. Current version support <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a>, Matlab and ASCII formats.</li>
</ol>
<p>Based on previous work-flow, any 3D CSEM modelling requires the following
input files:</p>
<ol class="arabic simple">
<li>A mesh file (current version supports Gmsh meshes)</li>
<li>A conductivity model associated with the materials defined in the mesh file</li>
<li>A list of receivers positions in ASCII format for the electric responses post-processing</li>
<li>A <code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> file where are defined the pre-processing parameters</li>
<li>A <code class="docutils literal"><span class="pre">modelParams.py</span></code> file where are defined the 3D CSEM parameters</li>
<li>A <code class="docutils literal"><span class="pre">petsc.opts</span></code> file where are defined options for <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> solvers</li>
<li>A <code class="docutils literal"><span class="pre">run_preprocessing.py</span></code> script and a <code class="docutils literal"><span class="pre">kernel.py</span></code> script which manage the pre-processing and modelling tasks respectively</li>
</ol>
</div>
<div class="section" id="pre-processing">
<span id="preprocessing-tutorial"></span><h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">run_preprocessing.py</span></code> script provides functions to change input file formats
into a representation that is more suitable for PETGEM. It transforms mesh files
with its conductivity model and receivers positions into a <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> binary format, which allow
parallel computations in a simple way. Therefore, this step is mandatory
for any modelling. <code class="docutils literal"><span class="pre">run_preprocessing.py</span></code> script is included in the top-level
directory of the PETGEM source tree.</p>
<p>The <code class="docutils literal"><span class="pre">run_preprocessing.py</span></code> script is invoked has follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python3 run_preprocessing.py path/preprocessingParams.py
</pre></div>
</div>
<p>A template of <code class="docutils literal"><span class="pre">run_preprocessing.py</span></code> script is included in <code class="docutils literal"><span class="pre">examples/</span></code>
of the PETGEM source tree. Additionally, a freely available copy of this file
is located at <a class="reference internal" href="Download.html#download"><span class="std std-ref">Download</span></a> section. Please, see
<a class="reference internal" href="#preprocessing-parameters-file"><span class="std std-ref">Pre-processing parameters file</span></a> section for more details about
<code class="docutils literal"><span class="pre">preprocessingParams.py</span></code> file.</p>
</div>
<div class="section" id="pre-processing-parameters-file">
<span id="preprocessing-parameters-file"></span><h2>Pre-processing parameters file<a class="headerlink" href="#pre-processing-parameters-file" title="Permalink to this headline">¶</a></h2>
<p>As already said, the first step for a 3D CSEM modelling using PETGEM is the
pre-processing phase. Here, a mesh file with its conductivity model and receivers
positions are exported to <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> binary files.</p>
<p>A glance of this file is the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Parameters file template for PETGEM preprocessing. Here a mesh file, conductivity model and receivers file are mandatory.</span>
<span class="c1"># In order to avoid a specific parser, this file is imported by PETGEM as a Python dictionary. As consequence, the dictionary</span>
<span class="c1"># name and his key names MUST NOT BE changed. All file paths should consider as absolute.</span>

<span class="n">preprocessing</span> <span class="o">=</span> <span class="p">{</span>
 <span class="c1"># ---------- Mesh file ----------</span>
 <span class="s1">&#39;MESH_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_preprocessing/DIPOLE1D.msh&#39;</span><span class="p">,</span>

 <span class="c1"># ---------- Material conductivities ----------</span>
 <span class="s1">&#39;MATERIAL_CONDUCTIVITIES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/.</span><span class="mi">3</span><span class="p">],</span>

 <span class="c1"># ---------- Receivers positions file ----------</span>
 <span class="s1">&#39;RECEIVERS_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_preprocessing/RECEIVER_POSITIONS.txt&#39;</span><span class="p">,</span>

 <span class="c1"># ---------- Path for Output ----------</span>
 <span class="s1">&#39;OUT_DIR&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/&#39;</span><span class="p">,</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>A template of this file is included in <code class="docutils literal"><span class="pre">examples/</span></code>
of the PETGEM source tree. Additionally, a freely available copy of this file
is located at <a class="reference internal" href="Download.html#download"><span class="std std-ref">Download</span></a> section. Furthermore, in
<a class="reference internal" href="Manual.html#preprocessing-manual"><span class="std std-ref">Pre-processing</span></a> section of the PETGEM Manual is included a
deep explanation about this file.</p>
</div>
<div class="section" id="running-a-simulation">
<span id="running-a-simulation-tutorial"></span><h2>Running a simulation<a class="headerlink" href="#running-a-simulation" title="Permalink to this headline">¶</a></h2>
<p>This section introduces the basics of running PETGEM on the command
line. Following command should be run in the top-level directory of the PETGEM
source tree.</p>
<p>PETGEM kernel is invoked as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mpirun -n MPI_tasks python3 kernel.py -options_file path/petsc.opts path/modelParams.py
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">MPI_tasks</span></code> is the number of MPI parallel tasks, <code class="docutils literal"><span class="pre">kernel.py</span></code> is
the script that manages the PETGEM work-flow, <code class="docutils literal"><span class="pre">petsc.opts</span></code> is the
<a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> options file and <code class="docutils literal"><span class="pre">modelParams.py</span></code>
is the modelling parameters file for PETGEM.</p>
<p>A template of this file is included in <code class="docutils literal"><span class="pre">examples/</span></code>
of the PETGEM source tree. Additionally, a freely available copy of this file
is located at <a class="reference internal" href="Download.html#download"><span class="std std-ref">Download</span></a> section.</p>
<p>See <a class="reference internal" href="#model-parameters-file"><span class="std std-ref">Model parameters file</span></a> section for more details about
<code class="docutils literal"><span class="pre">modelParams.py</span></code> file.</p>
</div>
<div class="section" id="model-parameters-file">
<span id="id8"></span><h2>Model parameters file<a class="headerlink" href="#model-parameters-file" title="Permalink to this headline">¶</a></h2>
<p>By definition, any 3D CSEM survey should include: physical parameters, a mesh
file, source and receivers files. These data are included in the
<code class="docutils literal"><span class="pre">modelParams.py</span></code> file. Additionally, options for
<a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> solvers are defined in a
<code class="docutils literal"><span class="pre">petsc.opts</span></code> file.</p>
<p>In order to avoid a specific parser, <code class="docutils literal"><span class="pre">modelParams.py</span></code> file is imported by
PETGEM as a Python dictionary. As consequence, the dictionary name and his key names
MUST NOT BE changed.</p>
<p>A glance of <code class="docutils literal"><span class="pre">modelParams.py</span></code> file is the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Parameters file template for 3D CSEM modelling.</span>
<span class="c1"># By definition, any 3D CSEM survey should include: physical parameters, a mesh file, source and receivers files. These data</span>
<span class="c1"># are included in the modelParams.py file. Additionally, options for PETSc solvers are defined in a petsc.opts file.</span>
<span class="c1"># In order to avoid a specific parser, modelParams.py file is imported by PETGEM as a Python dictionary. As consequence,</span>
<span class="c1"># the dictionary name and his key names MUST NOT BE changed. All file paths should consider as absolute.</span>

<span class="n">modelling</span> <span class="o">=</span> <span class="p">{</span>
 <span class="c1"># ----- Pyshical parameters -----</span>
 <span class="c1"># Source</span>
 <span class="c1"># Source frequency. Type: float</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;FREQ&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
 <span class="c1"># Source position(x, y, z). Type: float</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;SRC_POS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1750.0</span><span class="p">,</span> <span class="mf">1750.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">975.0</span><span class="p">],</span>
 <span class="c1"># Source orientarion. Type: int</span>
 <span class="c1"># 1 = X-directed source</span>
 <span class="c1"># 2 = Y-directed source</span>
 <span class="c1"># 3 = Z-directed source</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;SRC_DIREC&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="c1"># Source current. Type: float</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;SRC_CURRENT&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
 <span class="c1"># Source length. Type: float</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;SRC_LENGTH&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
 <span class="c1"># Conductivity model. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;CONDUCTIVITY_MODEL_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/conductivityModel.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Background conductivity. Type: float</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;CONDUCTIVITY_BACKGROUND&#39;</span><span class="p">:</span> <span class="mf">3.33</span><span class="p">,</span>

 <span class="c1"># ------- Mesh and conductivity model files ------</span>
 <span class="c1"># Mesh files</span>
 <span class="c1"># Nodes spatial coordinates. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;NODES_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/nodes.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Elements-nodes connectivity. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;MESH_CONNECTIVITY_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/meshConnectivity.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Elements-edges connectivity. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;DOFS_CONNECTIVITY_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/dofs.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Edges-nodes connectivity. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;DOFS_NODES_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/dofsNodes.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Sparsity pattern for matrix allocation (PETSc)</span>
 <span class="s1">&#39;NNZ_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/nnz.dat&#39;</span><span class="p">,</span>
 <span class="c1"># Boundaries. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;BOUNDARIES_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/boundaries.dat&#39;</span><span class="p">,</span>

 <span class="c1"># ------------ Solver -----------</span>
 <span class="c1"># Solver options must be set in</span>
 <span class="c1"># petsc_solver.opts</span>

 <span class="c1"># ------------ Receivers file -----------</span>
 <span class="c1"># Name of the file that contains the receivers position. Type: str</span>
 <span class="c1"># Optional: NO</span>
 <span class="s1">&#39;RECEIVERS_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;DIPOLE1D/Input_model/receivers.dat&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A template of this file is included in <code class="docutils literal"><span class="pre">examples/</span></code>
of the PETGEM source tree. Additionally, a freely available copy of this file
is located at <a class="reference internal" href="Download.html#download"><span class="std std-ref">Download</span></a> section. Furthermore, in
<a class="reference internal" href="Manual.html#running-a-simulation-manual"><span class="std std-ref">Running a simulation</span></a> section of the PETGEM Manual is included
a deep description about this file.</p>
</div>
<div class="section" id="visualization-of-results">
<span id="visualization-of-results-tutorial"></span><h2>Visualization of results<a class="headerlink" href="#visualization-of-results" title="Permalink to this headline">¶</a></h2>
<p>Once a solution of a 3D CSEM survey has been obtained, it should be
post-processed by using a visualization program. PETGEM does not do the
visualization by itself, but it generates output files (ASCII,
<a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> and Matlab formats are supported)
with the electric responses at receivers positions. It also gives timing values
in order to evaluate the performance.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Manual.html" title="Manual"
             >next</a> |</li>
        <li class="right" >
          <a href="Installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">Home</a>|&nbsp;</li>
        <li><a href="WhatIs.html">What is PETGEM?</a>|&nbsp;</li>
        <li><a href="Features.html">Features</a>|&nbsp;</li>
        <li><a href="CSEMEdges.html">CSEM FM modelling</a>|&nbsp;</li>
        <li><a href="Installation.html">Installation</a>|&nbsp;</li>
        <li><a href="#">Tutorial</a>|&nbsp;</li>
        <li><a href="Manual.html">Manual</a>|&nbsp;</li>
        <li><a href="Publications.html">Publications</a>|&nbsp;</li>
	      <li><a href="Download.html">Download</a>|&nbsp;</li>
        <li><a href="Contact.html">Contact</a></li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Octavio Castillo Reyes.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>