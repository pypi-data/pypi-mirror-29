
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>petgem.postprocessing.postprocessing &#8212; PETGEM 1.01 documentation</title>
    <link rel="stylesheet" href="../../../_static/petgem.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  <a href="../../../index.html"><img style="vertical-align: middle" src="../../../_static/figures/petgem_logo.png" border="0" height="80px" alt="PETGEM"/></a>
    <a href="../../../index.html"><strong><font color="#355f7c"> Parallel Edge-based Tool for Geophysical Electromagnetic Modelling</font></strong></a>
  <a href="http://www.bsc.es/"><img src="../../../_static/figures/logo_bsc.jpeg" align="right" border="0" height="80px" alt="BSC"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../WhatIs.html">What is PETGEM?</a>|&nbsp;</li>
        <li><a href="../../../Features.html">Features</a>|&nbsp;</li>
        <li><a href="../../../CSEMEdges.html">CSEM FM modelling</a>|&nbsp;</li>
        <li><a href="../../../Installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../../Tutorial.html">Tutorial</a>|&nbsp;</li>
        <li><a href="../../../Manual.html">Manual</a>|&nbsp;</li>
        <li><a href="../../../Publications.html">Publications</a>|&nbsp;</li>
	      <li><a href="../../../Download.html">Download</a>|&nbsp;</li>
        <li><a href="../../../Contact.html">Contact</a></li>

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for petgem.postprocessing.postprocessing</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Author:  Octavio Castillo Reyes</span>
<span class="c1"># Contact: octavio.castillo@bsc.es</span>
<span class="sd">&#39;&#39;&#39; Define the functions for post-processing task.</span>
<span class="sd">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="exportPetscToAscii"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.exportPetscToAscii">[docs]</a><span class="k">def</span> <span class="nf">exportPetscToAscii</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">xComponentFile</span><span class="p">,</span>
                       <span class="n">yComponentFile</span><span class="p">,</span> <span class="n">zComponentFile</span><span class="p">,</span> <span class="n">out_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Export a saved electric fields in petsc format to Ascii format.</span>

<span class="sd">    :param int nReceivers: total number of receivers</span>
<span class="sd">    :param str xComponentFile: petsc file name to be readed and exported</span>
<span class="sd">    :param str yComponentFile: petsc file name to be readed and exported</span>
<span class="sd">    :param str zComponentFile: petsc file name to be readed and exported</span>
<span class="sd">    :param str out_file: out file name for electric fields</span>
<span class="sd">    :return: electric field in numpy format</span>
<span class="sd">    :rtype: ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Build indexes list of receivers</span>
    <span class="n">indx_receivers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nReceivers</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="c1"># Allocate space for Electric fields</span>
    <span class="n">dataAscii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nReceivers</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="n">dataMatlab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nReceivers</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="c1"># Read field</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">readPetscVector</span><span class="p">(</span><span class="n">xComponentFile</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">COMM_SELF</span><span class="p">)</span>
    <span class="n">dataX</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">getArray</span><span class="p">()</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">readPetscVector</span><span class="p">(</span><span class="n">yComponentFile</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">COMM_SELF</span><span class="p">)</span>
    <span class="n">dataY</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">getArray</span><span class="p">()</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">readPetscVector</span><span class="p">(</span><span class="n">zComponentFile</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">COMM_SELF</span><span class="p">)</span>
    <span class="n">dataZ</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">getArray</span><span class="p">()</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">iRecv</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">):</span>
        <span class="n">dataAscii</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iRecv</span>
        <span class="n">dataAscii</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataX</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>
        <span class="n">dataAscii</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataY</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>
        <span class="n">dataAscii</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataZ</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>
        <span class="c1"># Set data for matlab matrix</span>
        <span class="n">dataMatlab</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataX</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>
        <span class="n">dataMatlab</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataY</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>
        <span class="n">dataMatlab</span><span class="p">[</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataZ</span><span class="p">[</span><span class="n">iRecv</span><span class="p">]</span>

    <span class="n">dataAscii</span> <span class="o">=</span> <span class="n">dataAscii</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">dataAscii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dataAscii</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">file_header</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Receiver</span><span class="se">\t\t\t</span><span class="s1">X-component</span><span class="se">\t\t\t\t\t</span><span class="s1">&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;Y-component</span><span class="se">\t\t\t\t\t</span><span class="s1">Z-component&#39;</span><span class="p">)</span>
    <span class="n">file_footer</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;--------   -------------------------&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;----------------------    ----------&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;------------------------------------&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;    ----------------------------------------------&#39;</span><span class="p">)</span>
    <span class="n">table_format</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;    </span><span class="si">%i</span><span class="s1"> </span><span class="se">\t</span><span class="s1">     </span><span class="si">%4.16e%+4.16e</span><span class="s1">j&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39; </span><span class="se">\t</span><span class="si">%4.16e%+4.16e</span><span class="s1">j </span><span class="se">\t</span><span class="s1">  </span><span class="si">%4.16e%+4.16e</span><span class="s1">j&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">dataAscii</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">table_format</span><span class="p">,</span>
               <span class="n">header</span><span class="o">=</span><span class="n">file_header</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="n">file_footer</span><span class="p">)</span>

    <span class="c1"># Insert time stamp to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
        <span class="n">TT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;PETGEM execution on: &#39;</span> <span class="o">+</span> <span class="n">TT</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dataMatlab</span></div>


<div class="viewcode-block" id="exportNumpytoMatlab"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.exportNumpytoMatlab">[docs]</a><span class="k">def</span> <span class="nf">exportNumpytoMatlab</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">electricField</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Export electric fields in numpy format to Matlab format.</span>

<span class="sd">    :param int data: electric fields to be saved</span>
<span class="sd">    :param str out_file: out file name for electric fields</span>
<span class="sd">    :return: none</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">electricField</span> <span class="o">==</span> <span class="s1">&#39;Primary&#39;</span><span class="p">:</span>
        <span class="n">dataName</span> <span class="o">=</span> <span class="s1">&#39;Ep&#39;</span>
    <span class="k">elif</span> <span class="n">electricField</span> <span class="o">==</span> <span class="s1">&#39;Secondary&#39;</span><span class="p">:</span>
        <span class="n">dataName</span> <span class="o">=</span> <span class="s1">&#39;Es&#39;</span>
    <span class="k">elif</span> <span class="n">electricField</span> <span class="o">==</span> <span class="s1">&#39;Total&#39;</span><span class="p">:</span>
        <span class="n">dataName</span> <span class="o">=</span> <span class="s1">&#39;Et&#39;</span>

    <span class="c1"># Save matlab data</span>
    <span class="n">savemat</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="p">{</span><span class="n">dataName</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>

    <span class="k">return</span></div>


<div class="viewcode-block" id="EpReceiverComputation"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.EpReceiverComputation">[docs]</a><span class="k">def</span> <span class="nf">EpReceiverComputation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compute the primary electric field for an array of point (receivers).</span>

<span class="sd">    :param object_modelling model: CSEM modelling with physical parameters</span>
<span class="sd">    :param ndarray point: receiver spatial coordinates</span>
<span class="sd">    :param int numDimensions: number of dimensions</span>
<span class="sd">    :return: primary electric field on receivers</span>
<span class="sd">    :rtype: ndarray.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Read physical parameters</span>
    <span class="c1"># ----------- Read physical parameters -----------</span>
    <span class="n">FREQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;FREQ&#39;</span><span class="p">])</span>
    <span class="n">SIGMA_BGROUND</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;CONDUCTIVITY_BACKGROUND&#39;</span><span class="p">])</span>
    <span class="n">SRC_POS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;SRC_POS&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">SRC_DIREC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;SRC_DIREC&#39;</span><span class="p">])</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;SRC_CURRENT&#39;</span><span class="p">])</span>
    <span class="n">dS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;SRC_LENGTH&#39;</span><span class="p">])</span>

    <span class="c1"># Source position as independent variables</span>
    <span class="n">X0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">SRC_POS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">SRC_POS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">Z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">SRC_POS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Compute constants</span>
    <span class="c1"># Imaginary part for complex numbers</span>
    <span class="n">imag_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="p">)</span>
    <span class="c1"># Vacuum permeability</span>
    <span class="n">MU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="mf">1.0e-7</span><span class="p">))</span>
    <span class="c1"># Angular frequency</span>
    <span class="n">OMEGA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">FREQ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="c1"># Propagation parameter</span>
    <span class="n">WAVENUMBER</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">imag_part</span><span class="o">*</span><span class="n">MU</span><span class="o">*</span><span class="n">OMEGA</span><span class="o">*</span><span class="n">SIGMA_BGROUND</span><span class="p">))</span>

    <span class="c1"># Allocate</span>
    <span class="n">Ep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numDimensions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

    <span class="c1"># Distance to the source</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">X0</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Y0</span>
    <span class="n">zz</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">Z0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">zz</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0e0</span><span class="p">)):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0e0</span><span class="p">)</span>

    <span class="c1"># E = AA [ BB + (wavenumber^2 * r^2 -1i * wavenumber * r-1)]</span>
    <span class="n">AA</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">dS</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">SIGMA_BGROUND</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**-</span><span class="mi">1</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">imag_part</span><span class="p">)</span> <span class="o">*</span> <span class="n">WAVENUMBER</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">BB</span> <span class="o">=</span> <span class="o">-</span><span class="n">WAVENUMBER</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">imag_part</span> <span class="o">*</span> <span class="n">WAVENUMBER</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">SRC_DIREC</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># X-directed</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">((</span><span class="n">xx</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span> <span class="o">+</span> <span class="p">(</span><span class="n">WAVENUMBER</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">imag_part</span> <span class="o">*</span>
                                         <span class="n">WAVENUMBER</span> <span class="o">*</span> <span class="n">r</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)))</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="n">yy</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="n">zz</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
    <span class="k">elif</span> <span class="n">SRC_DIREC</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Y-directed</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="n">yy</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">((</span><span class="n">yy</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span> <span class="o">+</span> <span class="p">(</span><span class="n">WAVENUMBER</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">imag_part</span> <span class="o">*</span>
                                         <span class="n">WAVENUMBER</span><span class="o">*</span><span class="n">r</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)))</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">yy</span><span class="o">*</span><span class="n">zz</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Z-directed</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="n">zz</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">zz</span><span class="o">*</span><span class="n">yy</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span>
        <span class="n">Ep</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">AA</span> <span class="o">*</span> <span class="p">((</span><span class="n">zz</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">BB</span> <span class="o">+</span> <span class="p">(</span><span class="n">WAVENUMBER</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">imag_part</span> <span class="o">*</span>
                                         <span class="n">WAVENUMBER</span><span class="o">*</span><span class="n">r</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">Ep</span></div>


<div class="viewcode-block" id="EtReceiverComputation"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.EtReceiverComputation">[docs]</a><span class="k">def</span> <span class="nf">EtReceiverComputation</span><span class="p">(</span><span class="n">primary_field</span><span class="p">,</span> <span class="n">secondary_field</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compute the total electric field on receivers.</span>

<span class="sd">    :param ndarray primary_field: primary electric field on receiver.</span>
<span class="sd">    :param ndarray secondary_field: secondary electric field on receiver.</span>
<span class="sd">    :param int numDimensions: number of dimensions</span>
<span class="sd">    :return: total electric field on receivers.</span>
<span class="sd">    :rtype: ndarray.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Compute total field</span>
    <span class="n">Et</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numDimensions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="n">Et</span> <span class="o">=</span> <span class="n">primary_field</span> <span class="o">+</span> <span class="n">secondary_field</span>

    <span class="k">return</span> <span class="n">Et</span></div>


<div class="viewcode-block" id="EsReceiverComputation"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.EsReceiverComputation">[docs]</a><span class="k">def</span> <span class="nf">EsReceiverComputation</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">coordEle</span><span class="p">,</span> <span class="n">coordReceiver</span><span class="p">,</span> <span class="n">nodesEle</span><span class="p">,</span>
                          <span class="n">edgeOrder</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compute the secondary electric field on receivers.</span>

<span class="sd">    :param ndarray field: secondary field to be interpolated</span>
<span class="sd">    :param ndarray coordElement: element spatial coordinates</span>
<span class="sd">    :param ndarray coordReceiver: receiver spatial coordinates</span>
<span class="sd">    :param ndarray nodesEle: nodal indices of element (element container)</span>
<span class="sd">    :param int edgeOrder: order of tetrahedral edge element</span>
<span class="sd">    :param int numDimensions: number of dimensions</span>
<span class="sd">    :return: secondary electric field on receivers</span>
<span class="sd">    :rtype: ndarray.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Imaginary part for complex numbers</span>
    <span class="n">imag_part</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="p">)</span>

    <span class="c1"># ----------- Edge definition for the tetrahedral elements -----------</span>
    <span class="c1"># ----- Table 8.2 of Jin&#39;s book. Here is consider as an 1D-array -----</span>
    <span class="n">edgesN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

    <span class="c1"># ----------- Definition of arrays for vector operations -----------</span>
    <span class="c1"># Signs computation</span>
    <span class="n">idx_signs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="n">idx_signs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

    <span class="c1"># Allocate</span>
    <span class="n">Es</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numDimensions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

    <span class="c1"># ----------- Compute edges&#39;s length of element -----------</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">coordEle</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">edgesN</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">lengthEle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">edges</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># ----------- Compute element&#39;s volume -----------</span>
    <span class="n">CONST_VOL1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span>
    <span class="n">eleVol</span> <span class="o">=</span> <span class="p">(((</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">-</span>
              <span class="p">((</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span>
               <span class="p">(</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">coordEle</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">*</span> <span class="n">CONST_VOL1</span>

    <span class="c1"># ----------- Edge&#39;s signs -----------</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">nodesEle</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">idx_signs1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">[</span><span class="n">idx_signs2</span><span class="p">]</span>
    <span class="n">signsEle</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1"># Nedelec basis computation</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">nedelecBasisIterative</span><span class="p">(</span><span class="n">coordEle</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                  <span class="n">coordReceiver</span><span class="p">,</span> <span class="n">eleVol</span><span class="p">,</span> <span class="n">lengthEle</span><span class="p">,</span> <span class="n">edgeOrder</span><span class="p">)</span>

    <span class="n">rField</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">iField</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="c1"># Compute secondary field</span>
    <span class="k">for</span> <span class="n">kedge</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">edgeOrder</span><span class="p">):</span>
        <span class="c1"># Add contributions</span>
        <span class="n">Es</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">rField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="n">imag_part</span><span class="o">*</span><span class="n">iField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span>
        <span class="n">Es</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">rField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="n">imag_part</span><span class="o">*</span><span class="n">iField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span>
        <span class="n">Es</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">rField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="n">imag_part</span><span class="o">*</span><span class="n">iField</span><span class="p">[</span><span class="n">kedge</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">[</span><span class="n">kedge</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">signsEle</span><span class="p">[</span><span class="n">kedge</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">Es</span></div>


<div class="viewcode-block" id="computeFieldsReceiver"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.computeFieldsReceiver">[docs]</a><span class="k">def</span> <span class="nf">computeFieldsReceiver</span><span class="p">(</span><span class="n">modelling</span><span class="p">,</span> <span class="n">coordReceiver</span><span class="p">,</span> <span class="n">coordElement</span><span class="p">,</span>
                          <span class="n">nodesElement</span><span class="p">,</span> <span class="n">x_field</span><span class="p">,</span> <span class="n">edgeOrder</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compute the CSEM modelling output: primary electric field, secondary</span>
<span class="sd">    electric field and total electric field on receivers position.</span>

<span class="sd">    :param object_modelling model: CSEM modelling with physical parameters</span>
<span class="sd">    :param ndarray coordReceiver: receiver spatial coordinates</span>
<span class="sd">    :param ndarray coordElement: element spatial coordinates</span>
<span class="sd">    :param ndarray nodesElement: nodal indices of element (element container)</span>
<span class="sd">    :param ndarray x_field: vector solution for receiver</span>
<span class="sd">    :param int edgeOrder: order of tetrahedral edge element</span>
<span class="sd">    :param int numDimensions: number of dimensions</span>
<span class="sd">    :return: primary, secondary and total electric field</span>
<span class="sd">    :rtype: ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># ----- Primary field computation -----</span>
    <span class="n">Ep</span> <span class="o">=</span> <span class="n">EpReceiverComputation</span><span class="p">(</span><span class="n">modelling</span><span class="p">,</span> <span class="n">coordReceiver</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">)</span>

    <span class="c1"># ----- Secondary field computation -----</span>
    <span class="n">Es</span> <span class="o">=</span> <span class="n">EsReceiverComputation</span><span class="p">(</span><span class="n">x_field</span><span class="p">,</span> <span class="n">coordElement</span><span class="p">,</span> <span class="n">coordReceiver</span><span class="p">,</span>
                               <span class="n">nodesElement</span><span class="p">,</span> <span class="n">edgeOrder</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">)</span>

    <span class="c1"># ----- Total field computation -----</span>
    <span class="n">Et</span> <span class="o">=</span> <span class="n">EtReceiverComputation</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Es</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Ep</span><span class="p">,</span> <span class="n">Es</span><span class="p">,</span> <span class="n">Et</span></div>


<div class="viewcode-block" id="postProcessingFields"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.postProcessingFields">[docs]</a><span class="k">def</span> <span class="nf">postProcessingFields</span><span class="p">(</span><span class="n">receivers</span><span class="p">,</span> <span class="n">modelling</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Iend_receivers</span><span class="p">,</span>
                         <span class="n">Istart_receivers</span><span class="p">,</span> <span class="n">edgeOrder</span><span class="p">,</span> <span class="n">nodalOrder</span><span class="p">,</span>
                         <span class="n">numDimensions</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Compute the CSEM modelling output: primary electric field, secondary</span>
<span class="sd">    electric field and total electric field on receivers position.</span>

<span class="sd">    :param petsc matrix receivers: data receivers to compute electric fields</span>
<span class="sd">    :param object_modelling model: CSEM modelling with physical parameters.</span>
<span class="sd">    :param petsc vector x: solution vector</span>
<span class="sd">    :param int Iend_receivers: last range for receivers</span>
<span class="sd">    :param int Istart_receivers: init range for receivers</span>
<span class="sd">    :param int edgeOrder: order of tetrahedral edge element</span>
<span class="sd">    :param int nodalOrder: order of tetrahedral nodal element</span>
<span class="sd">    :param int numDimensions: number of dimensions</span>
<span class="sd">    :param int rank: MPI rank</span>
<span class="sd">    :return: elapsedTimepostprocessing</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Start timer</span>
    <span class="n">Init_postprocessing</span> <span class="o">=</span> <span class="n">getTime</span><span class="p">()</span>

    <span class="c1"># Number of receivers</span>
    <span class="n">nReceivers</span> <span class="o">=</span> <span class="n">receivers</span><span class="o">.</span><span class="n">getSize</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nReceiversLocal</span> <span class="o">=</span> <span class="n">Iend_receivers</span><span class="o">-</span><span class="n">Istart_receivers</span>

    <span class="c1"># Print number of receivers per MPI task</span>
    <span class="n">PETSc</span><span class="o">.</span><span class="n">Sys</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s1">&#39;  Number of receivers:&#39;</span><span class="p">,</span> <span class="n">nReceivers</span><span class="p">)</span>
    <span class="n">PETSc</span><span class="o">.</span><span class="n">Sys</span><span class="o">.</span><span class="n">syncPrint</span><span class="p">(</span><span class="s1">&#39;    Rank: &#39;</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39; is post-processing &#39;</span><span class="p">,</span>
                        <span class="n">nReceiversLocal</span><span class="p">,</span> <span class="s1">&#39; receivers&#39;</span><span class="p">)</span>
    <span class="n">PETSc</span><span class="o">.</span><span class="n">Sys</span><span class="o">.</span><span class="n">syncFlush</span><span class="p">()</span>

    <span class="c1"># Read edges-connectivity for receivers</span>
    <span class="c1"># Auxiliar arrays</span>
    <span class="n">dataRecv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">edgeOrder</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">edgesIdxRecv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nReceiversLocal</span><span class="p">,</span> <span class="n">edgeOrder</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">IntType</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">iRecv</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Istart_receivers</span><span class="p">,</span> <span class="n">Iend_receivers</span><span class="p">):</span>
        <span class="c1"># Get data of iRecv</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">receivers</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">iRecv</span><span class="p">))</span>
        <span class="n">dataRecv</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span><span class="mi">25</span><span class="p">])</span>
        <span class="c1"># Edge-indexes for iRecv</span>
        <span class="n">edgesIdxRecv</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataRecv</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">PETSc</span><span class="o">.</span><span class="n">IntType</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Gather global solution of x to local vector</span>
    <span class="c1"># Sequential vector for gather tasks</span>
    <span class="n">x_local</span> <span class="o">=</span> <span class="n">createSequentialVector</span><span class="p">(</span><span class="n">edgeOrder</span><span class="o">*</span><span class="n">nReceiversLocal</span><span class="p">,</span>
                                     <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Build Index set in PETSc format</span>
    <span class="n">IS_edges</span> <span class="o">=</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">IS</span><span class="p">()</span><span class="o">.</span><span class="n">createGeneral</span><span class="p">(</span><span class="n">edgesIdxRecv</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                        <span class="n">comm</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">)</span>
    <span class="c1"># Build gather vector</span>
    <span class="n">gatherVector</span> <span class="o">=</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">Scatter</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">IS_edges</span><span class="p">,</span> <span class="n">x_local</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Ghater values</span>
    <span class="n">gatherVector</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_local</span><span class="p">,</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">,</span>
                         <span class="n">PETSc</span><span class="o">.</span><span class="n">ScatterMode</span><span class="o">.</span><span class="n">FORWARD</span><span class="p">)</span>

    <span class="c1"># Post-processing electric fields</span>
    <span class="c1"># Create parallel structures</span>
    <span class="n">EpX</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EpY</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EpZ</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EsX</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EsY</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EsZ</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EtX</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EtY</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EtZ</span> <span class="o">=</span> <span class="n">createParallelVector</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EpDense</span> <span class="o">=</span> <span class="n">createParallelDenseMatrix</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">,</span>
                                        <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EsDense</span> <span class="o">=</span> <span class="n">createParallelDenseMatrix</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">,</span>
                                        <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">EtDense</span> <span class="o">=</span> <span class="n">createParallelDenseMatrix</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span> <span class="n">numDimensions</span><span class="p">,</span>
                                        <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Reshape auxiliar array</span>
    <span class="n">dataRecv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numDimensions</span><span class="o">+</span><span class="n">nodalOrder</span><span class="o">*</span><span class="n">numDimensions</span><span class="o">+</span><span class="n">nodalOrder</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="c1"># Compute fields for all local receivers</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">iRecv</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Istart_receivers</span><span class="p">,</span> <span class="n">Iend_receivers</span><span class="p">):</span>
        <span class="c1"># Get data of iRecv</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">receivers</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">iRecv</span><span class="p">))</span>
        <span class="n">dataRecv</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">19</span><span class="p">])</span>
        <span class="c1"># Receivers coordinates</span>
        <span class="n">coordReceiver</span> <span class="o">=</span> <span class="n">dataRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># Element coordinates</span>
        <span class="n">coordElement</span> <span class="o">=</span> <span class="n">dataRecv</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
        <span class="c1"># Nodal-indexes</span>
        <span class="n">nodesElement</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataRecv</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">19</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">PETSc</span><span class="o">.</span><span class="n">IntType</span><span class="p">)</span>
        <span class="c1"># Compute fields</span>
        <span class="p">[</span><span class="n">EpRecv</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">]</span> <span class="o">=</span> <span class="n">computeFieldsReceiver</span><span class="p">(</span><span class="n">modelling</span><span class="p">,</span>
                                                         <span class="n">coordReceiver</span><span class="p">,</span>
                                                         <span class="n">coordElement</span><span class="p">,</span>
                                                         <span class="n">nodesElement</span><span class="p">,</span>
                                                         <span class="n">x_local</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span>
                                                                 <span class="n">edgeOrder</span><span class="p">:</span>
                                                                 <span class="p">(</span><span class="n">idx</span> <span class="o">*</span>
                                                                  <span class="n">edgeOrder</span><span class="p">)</span> <span class="o">+</span>
                                                                 <span class="n">edgeOrder</span><span class="p">],</span>
                                                         <span class="n">edgeOrder</span><span class="p">,</span>
                                                         <span class="n">numDimensions</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Set primary field components</span>
        <span class="n">EpX</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EpY</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EpZ</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EpDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EpDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EpDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">EpRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="c1"># Set secondary field components</span>
        <span class="n">EsX</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EsY</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EsZ</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                     <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EsDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EsDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EsDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">EsRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="c1"># Set total field components</span>
        <span class="n">EtX</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EtY</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EtZ</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EtDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EtDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>
        <span class="n">EtDense</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">iRecv</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">EtRecv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                         <span class="n">addv</span><span class="o">=</span><span class="n">PETSc</span><span class="o">.</span><span class="n">InsertMode</span><span class="o">.</span><span class="n">INSERT_VALUES</span><span class="p">)</span>

    <span class="c1"># Start global vector assembly</span>
    <span class="n">EpX</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EpY</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EpZ</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">()</span>
    <span class="n">EsX</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EsY</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EsZ</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">()</span>
    <span class="n">EtX</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EtY</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EtZ</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">()</span>
    <span class="n">EpDense</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EsDense</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">(),</span> <span class="n">EtDense</span><span class="o">.</span><span class="n">assemblyBegin</span><span class="p">()</span>
    <span class="c1"># End global vector assembly</span>
    <span class="n">EpX</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EpY</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EpZ</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">()</span>
    <span class="n">EsX</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EsY</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EsZ</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">()</span>
    <span class="n">EtX</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EtY</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EtZ</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">()</span>
    <span class="n">EpDense</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EsDense</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">(),</span> <span class="n">EtDense</span><span class="o">.</span><span class="n">assemblyEnd</span><span class="p">()</span>

    <span class="c1"># Verify if directory exists</span>
    <span class="n">MASTER</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="n">MASTER</span><span class="p">:</span>
        <span class="n">checkIfDirectoryExist</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc&#39;</span><span class="p">)</span>
        <span class="n">checkIfDirectoryExist</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Ascii&#39;</span><span class="p">)</span>
        <span class="n">checkIfDirectoryExist</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Matlab&#39;</span><span class="p">)</span>

    <span class="c1"># Print</span>
    <span class="n">PETSc</span><span class="o">.</span><span class="n">Sys</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s1">&#39;  Saving output:&#39;</span><span class="p">)</span>
    <span class="c1"># Export electric fields (petsc format)</span>
    <span class="n">printMessage</span><span class="p">(</span><span class="s1">&#39;    Petsc format&#39;</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
    <span class="c1"># Save primary electric field</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpX.dat&#39;</span><span class="p">,</span>
                     <span class="n">EpX</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpY.dat&#39;</span><span class="p">,</span>
                     <span class="n">EpY</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpZ.dat&#39;</span><span class="p">,</span>
                     <span class="n">EpZ</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writeDenseMatrix</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/Ep.dat&#39;</span><span class="p">,</span>
                     <span class="n">EpDense</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Save secondary electric field</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsX.dat&#39;</span><span class="p">,</span>
                     <span class="n">EsX</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsY.dat&#39;</span><span class="p">,</span>
                     <span class="n">EsY</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsZ.dat&#39;</span><span class="p">,</span>
                     <span class="n">EsZ</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writeDenseMatrix</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/Es.dat&#39;</span><span class="p">,</span>
                     <span class="n">EsDense</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Save total electric field</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtX.dat&#39;</span><span class="p">,</span>
                     <span class="n">EtX</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtY.dat&#39;</span><span class="p">,</span>
                     <span class="n">EtY</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writePetscVector</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtZ.dat&#39;</span><span class="p">,</span>
                     <span class="n">EtZ</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">writeDenseMatrix</span><span class="p">(</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/Et.dat&#39;</span><span class="p">,</span>
                     <span class="n">EtDense</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Export electric fields (Ascii and Matlab format)</span>
    <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="n">MASTER</span><span class="p">:</span>
        <span class="c1"># Export electric fields (Ascii format)</span>
        <span class="c1"># Save primary electric field</span>
        <span class="n">printMessage</span><span class="p">(</span><span class="s1">&#39;    Ascii format&#39;</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
        <span class="n">dataEp</span> <span class="o">=</span> <span class="n">exportPetscToAscii</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EpX.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EpY.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EpZ.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Ascii/Ep.dat&#39;</span><span class="p">)</span>
        <span class="c1"># Save secondary electric field</span>
        <span class="n">dataEs</span> <span class="o">=</span> <span class="n">exportPetscToAscii</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EsX.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EsY.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EsZ.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Ascii/Es.dat&#39;</span><span class="p">)</span>
        <span class="c1"># Save total electric field</span>
        <span class="n">dataEt</span> <span class="o">=</span> <span class="n">exportPetscToAscii</span><span class="p">(</span><span class="n">nReceivers</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EtX.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EtY.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Petsc/EtZ.dat&#39;</span><span class="p">,</span>
                                    <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;/Output/Ascii/Et.dat&#39;</span><span class="p">)</span>
        <span class="c1"># Export electric fields (Matlab format)</span>
        <span class="n">printMessage</span><span class="p">(</span><span class="s1">&#39;    Matlab format&#39;</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
        <span class="c1"># Save primary electric field</span>
        <span class="n">exportNumpytoMatlab</span><span class="p">(</span><span class="n">dataEp</span><span class="p">,</span> <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39;/Output/Matlab/Ep.mat&#39;</span><span class="p">,</span> <span class="n">electricField</span><span class="o">=</span><span class="s1">&#39;Primary&#39;</span><span class="p">)</span>
        <span class="c1"># Save secondary electric field</span>
        <span class="n">exportNumpytoMatlab</span><span class="p">(</span><span class="n">dataEs</span><span class="p">,</span> <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39;/Output/Matlab/Es.mat&#39;</span><span class="p">,</span> <span class="n">electricField</span><span class="o">=</span><span class="s1">&#39;Secondary&#39;</span><span class="p">)</span>
        <span class="c1"># Save total electric field</span>
        <span class="n">exportNumpytoMatlab</span><span class="p">(</span><span class="n">dataEt</span><span class="p">,</span> <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span>
                            <span class="s1">&#39;/Output/Matlab/Et.mat&#39;</span><span class="p">,</span> <span class="n">electricField</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
        <span class="c1"># Remove temporal files (petsc)</span>
        <span class="n">filesToDelete</span> <span class="o">=</span> <span class="p">[</span><span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpX.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpY.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpZ.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsX.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsY.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsZ.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtX.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtY.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtZ.dat&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpX.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpY.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EpZ.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsX.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsY.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EsZ.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtX.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtY.dat.info&#39;</span><span class="p">,</span>
                         <span class="n">modelling</span><span class="p">[</span><span class="s1">&#39;DIR_NAME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/Output/Petsc/EtZ.dat.info&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">iFile</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filesToDelete</span><span class="p">)):</span>
            <span class="n">removeFile</span><span class="p">(</span><span class="n">filesToDelete</span><span class="p">[</span><span class="n">iFile</span><span class="p">])</span>

    <span class="c1"># End timer</span>
    <span class="n">End_postprocessing</span> <span class="o">=</span> <span class="n">getTime</span><span class="p">()</span>

    <span class="c1"># Elapsed time in assembly</span>
    <span class="n">elapsedTimepostprocessing</span> <span class="o">=</span> <span class="n">End_postprocessing</span><span class="o">-</span><span class="n">Init_postprocessing</span>

    <span class="k">return</span> <span class="n">elapsedTimepostprocessing</span></div>


<div class="viewcode-block" id="unitary_test"><a class="viewcode-back" href="../../../petgem/postprocessing/postprocessing.html#petgem.postprocessing.postprocessing.unitary_test">[docs]</a><span class="k">def</span> <span class="nf">unitary_test</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39; Unitary test for post_processing.py script.</span>
<span class="sd">    &#39;&#39;&#39;</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Standard module import</span>
    <span class="n">unitary_test</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Standard module import</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="kn">from</span> <span class="nn">scipy.io</span> <span class="k">import</span> <span class="n">savemat</span>
    <span class="kn">import</span> <span class="nn">petsc4py</span>
    <span class="kn">from</span> <span class="nn">petsc4py</span> <span class="k">import</span> <span class="n">PETSc</span>
    <span class="c1"># PETGEM module import</span>
    <span class="kn">from</span> <span class="nn">petgem.base.base</span> <span class="k">import</span> <span class="n">checkIfDirectoryExist</span>
    <span class="kn">from</span> <span class="nn">petgem.base.base</span> <span class="k">import</span> <span class="n">removeFile</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">createSequentialVector</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">createParallelVector</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">readPetscVector</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">writePetscVector</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">createParallelDenseMatrix</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">printMessage</span>
    <span class="kn">from</span> <span class="nn">petgem.parallel.parallel</span> <span class="k">import</span> <span class="n">writeDenseMatrix</span>
    <span class="kn">from</span> <span class="nn">petgem.efem.efem</span> <span class="k">import</span> <span class="n">nedelecBasisIterative</span>
    <span class="kn">from</span> <span class="nn">petgem.monitoring.monitoring</span> <span class="k">import</span> <span class="n">getTime</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Home</a>|&nbsp;</li>
        <li><a href="../../../WhatIs.html">What is PETGEM?</a>|&nbsp;</li>
        <li><a href="../../../Features.html">Features</a>|&nbsp;</li>
        <li><a href="../../../CSEMEdges.html">CSEM FM modelling</a>|&nbsp;</li>
        <li><a href="../../../Installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../../Tutorial.html">Tutorial</a>|&nbsp;</li>
        <li><a href="../../../Manual.html">Manual</a>|&nbsp;</li>
        <li><a href="../../../Publications.html">Publications</a>|&nbsp;</li>
	      <li><a href="../../../Download.html">Download</a>|&nbsp;</li>
        <li><a href="../../../Contact.html">Contact</a></li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Octavio Castillo Reyes.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>