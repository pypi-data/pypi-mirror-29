

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Isotopologue Library &mdash; pyQms 0.5.0-beta documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pyQms 0.5.0-beta documentation" href="index.html"/>
        <link rel="next" title="Result Class" href="results.html"/>
        <link rel="prev" title="Quick start" href="quick_start.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pyQms
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick start</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Isotopologue Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Result Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="chemical_composition.html">Chemical composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="unimod_mapper.html">Unimod mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptors.html">Adaptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="params.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_scripts.html">Example Scripts</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyQms</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Isotopologue Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/isotopologue_library.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="isotopologue-library">
<h1>Isotopologue Library<a class="headerlink" href="#isotopologue-library" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="pyqms.IsotopologueLibrary">
<em class="property">class </em><code class="descclassname">pyqms.</code><code class="descname">IsotopologueLibrary</code><span class="sig-paren">(</span><em>molecules=None</em>, <em>charges=None</em>, <em>metabolic_labels=None</em>, <em>fixed_labels=None</em>, <em>params=None</em>, <em>trivial_names=None</em>, <em>verbose=True</em>, <em>evidences=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyqms.IsotopologueLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>The Isotopologue library is the core of pyQms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Keyword Arguments:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>molecules</strong> (<em>list of str</em>) – Molecules used to build the library,
for more details see below.</li>
<li><strong>charges</strong> (<em>list of int</em>) – Charge list used to build the library</li>
<li><strong>metabolic_labels</strong> (<em>dict</em>) – see below</li>
<li><strong>fixed_labels</strong> (<em>dict</em>) – see below</li>
<li><strong>params</strong> (<em>dict</em>) – Match parameters, see <cite>pyqms.params</cite></li>
<li><strong>trivial_names</strong> (<em>dict</em>) – Dictionary that is used to build up lookups.
Key is a molecule and value a trivial name.</li>
<li><strong>evidences</strong> (<em>dict</em>) – Dictionary that is used to build up additional
lookups. Key is a formula pointing to a subdict. Subdict has
molecules as keys and values are ‘trivial_names’ as a list and
‘evidences’ holding evidence/identification information</li>
<li><strong>verbose</strong> (<em>bool</em>) – Be verbose or not during initialization and matching.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Keyword argument examples:</p>
<ul>
<li><p class="first"><strong>molecules</strong> The molecule format can be anything that the
ChemicalComposition class understands. Currently this can for example
be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="s1">&#39;+</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;H2O&#39;</span><span class="p">),</span>
    <span class="s1">&#39;</span><span class="si">{peptide}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peptide</span><span class="o">=</span><span class="s1">&#39;PEPTIDE&#39;</span><span class="p">),</span>
    <span class="s1">&#39;</span><span class="si">{peptide}</span><span class="s1">+</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;PO3&#39;</span><span class="p">,</span> <span class="n">peptide</span><span class="o">=</span><span class="s1">&#39;PEPTIDE&#39;</span><span class="p">),</span>
    <span class="s1">&#39;</span><span class="si">{peptide}</span><span class="s1">#</span><span class="si">{unimod}</span><span class="s1">:</span><span class="si">{pos}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">peptide</span> <span class="o">=</span> <span class="n">peptide</span><span class="p">,</span>
        <span class="n">unimod</span> <span class="o">=</span> <span class="s1">&#39;Oxidation&#39;</span><span class="p">,</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>metabolic_labels</strong> is used to define new element pools
with enriched isotopes. The dict key defines an enriched element,
e.g. 15N or 13C and its value is a list of floats [0 - 1.0] defining
enrichment.The combination of those pools is used to
calculate isotopologues:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;15N&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>fixed_labels</strong> are based on <a class="reference external" href="http://www.unimod.org/modifications_list.php?">unimod</a>. Fixed molecules
do not change the shape of the isotoplogue drastically but introduce
a simple mass shift, like SILAC, 18O or others.</p>
<p>The format is for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;R&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;C(-6) 13C(6) N(-4) 15N(4)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Isotopologue library as dict where the top key is always the
chemical forumla unimod style.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p>simplified:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;C(34)H(53)N(7)O(15)&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>
        <span class="s1">&#39;env&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="p">((</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;0.000&#39;</span><span class="p">),):</span> <span class="p">{</span>
                <span class="c1"># charge :</span>
                <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># all transformed mz values</span>
                    <span class="s1">&#39;atmzs&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="mi">800443</span><span class="p">,</span>
                        <span class="mi">800444</span><span class="p">,</span>
                        <span class="c1"># ... skipped</span>
                        <span class="mi">803459</span><span class="p">,</span>
                        <span class="mi">803460</span><span class="p">,</span>
                        <span class="mi">803461</span>
                    <span class="p">},</span>
                    <span class="c1"># theoretical mz values</span>
                    <span class="s1">&#39;mz&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="mf">800.4472772254203</span><span class="p">,</span>
                        <span class="mf">801.450389542063</span><span class="p">,</span>
                        <span class="mf">802.4536114854914</span><span class="p">,</span>
                        <span class="mf">803.4568170275203</span><span class="p">,</span>
                        <span class="mf">804.4597382487398</span><span class="p">,</span>
                        <span class="mf">805.463171867346</span><span class="p">,</span>
                        <span class="mf">806.4631454917885</span><span class="p">,</span>
                        <span class="mf">807.4676949759603</span>
                    <span class="p">],</span>
                    <span class="c1"># transformed mz values within error</span>
                    <span class="c1"># packages are on on peak level</span>
                    <span class="s1">&#39;tmzs&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="mi">800443</span><span class="p">,</span>
                            <span class="mi">800444</span><span class="p">,</span>
                            <span class="c1"># ... skipped</span>
                            <span class="mi">800451</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="mi">801446</span><span class="p">,</span>
                            <span class="mi">801447</span><span class="p">,</span>
                            <span class="c1"># ... skipped</span>
                            <span class="mi">801454</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="mi">802450</span><span class="p">,</span>
                            <span class="mi">802451</span><span class="p">,</span>
                            <span class="c1"># ... skipped</span>
                            <span class="mi">802458</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                        <span class="mi">803453</span><span class="p">,</span>
                            <span class="mi">803454</span><span class="p">,</span>
                            <span class="mi">803455</span><span class="p">,</span>
                            <span class="c1"># ... skipped</span>
                            <span class="mi">803461</span>
                        <span class="p">},</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span><span class="p">,</span>
                        <span class="kc">None</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="c1"># charge independent information</span>
                 <span class="s1">&#39;abun&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="mi">64799</span><span class="p">,</span>
                    <span class="mi">26251</span><span class="p">,</span>
                    <span class="mi">7164</span><span class="p">,</span>
                    <span class="mi">1456</span><span class="p">,</span>
                    <span class="mi">175</span><span class="p">,</span>
                    <span class="mi">20</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="mi">0</span>
                <span class="p">],</span>
                <span class="s1">&#39;c_peak_pos&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="kc">None</span>
                <span class="p">],</span>
                <span class="s1">&#39;isot&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="mf">799.3599640346001</span><span class="p">,</span>
                    <span class="mf">800.3629760500413</span><span class="p">,</span>
                    <span class="mf">801.3660976813065</span><span class="p">,</span>
                    <span class="mf">802.3692029128123</span><span class="p">,</span>
                    <span class="mf">803.3720238519379</span><span class="p">,</span>
                    <span class="mf">804.3753571372156</span><span class="p">,</span>
                    <span class="mf">805.3752307742944</span><span class="p">,</span>
                    <span class="mf">806.3796798135622</span>
                <span class="p">],</span>
                <span class="s1">&#39;n_c_peaks&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="s1">&#39;relabun&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="mf">1.0</span><span class="p">,</span>
                    <span class="mf">0.40511743373159037</span><span class="p">,</span>
                    <span class="mf">0.11054965400744385</span><span class="p">,</span>
                    <span class="mf">0.022466784140529883</span><span class="p">,</span>
                    <span class="mf">0.002693331560888158</span><span class="p">,</span>
                    <span class="mf">0.0003019650321460501</span><span class="p">,</span>
                    <span class="mf">7.716705830708012e-06</span><span class="p">,</span>
                    <span class="mf">3.639837831552297e-08</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="method">
<dt id="pyqms.IsotopologueLibrary.match_all">
<code class="descname">match_all</code><span class="sig-paren">(</span><em>mz_i_list=None</em>, <em>file_name=None</em>, <em>spec_id=None</em>, <em>spec_rt=None</em>, <em>results=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyqms.IsotopologueLibrary.match_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Matches all isotopologues in the library agains a given <em>mz_i_list</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mz_i_list</strong> (<em>list of tuples</em>) – Spectrum information that should be
matched against. Tuples of m/z and intensity</li>
<li><strong>file_name</strong> (<em>str</em>) – Information used for storage purpose. Useful if
multiple files are parsed with one pyqms.result instance.</li>
<li><strong>spec_id</strong> (<em>int</em>) – Information used for storage purpose.</li>
<li><strong>spec_rt</strong> (<em>float</em>) – Information used for storage purpose.</li>
<li><strong>results</strong> (<cite>pyqms.Results</cite>) – (optional)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If a results object is passed to match_all, then this object will be
updated and returned. This is for e.g. to accumulate results for a whole
LC-MS/MS run.</p>
<p>For various examples using match_all please refer to the example scripts.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Object holding all quantitative information</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">results class object (obj)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pyqms.IsotopologueLibrary.match_isotopologue">
<code class="descname">match_isotopologue</code><span class="sig-paren">(</span><em>index=None</em>, <em>formula=None</em>, <em>charge=None</em>, <em>label_percentile=None</em>, <em>spec_tmz_set=None</em>, <em>spec_tmz_lookup=None</em>, <em>mz_i_list=None</em>, <em>mz_score_percentile=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyqms.IsotopologueLibrary.match_isotopologue" title="Permalink to this definition">¶</a></dt>
<dd><p>Matches a single isotopologue onto a <em>mz_i_list</em> or <em>spec_tmz_set</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> (<em>int</em>) – Using this index one can retrieve all information
about the molecule, i.e. lower_mz, upper_mz, charge,
label_percentile, formula from <em>self.formulas_sorted_by_mz</em>.
Alternatively, one can use the more
verbose option: formula, charge and label_percentile</li>
<li><strong>formula</strong> (<em>str</em>) – pyqms formula type</li>
<li><strong>charge</strong> (<em>int</em>) – molecule charge</li>
<li><strong>label_percentile</strong> – pyQms label percentile</li>
<li><strong>mz_i_list</strong> (<em>list of tuples</em>) – List of m/z and intensity tuples, will
be transformed to a spec_tmz_set given the defined precession.
Alternatively, spec_tmz_set can be used as input.</li>
<li><strong>spec_tmz_set</strong> (<em>set of ints</em>) – tmz value set used for matching.
Requires spec_tmz_lookup to get the actual mz which is required
for scoring.</li>
<li><strong>mz_score_percentile</strong> (<em>float</em>) – Weighting of mz used for scoring.
(1 - mz_score_percentile) is then intensity weighting.
Values 0 - 1.0.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on the machine (some measure intensity better than others)
adjusting mz_score_percentile value will give
more accurate results. Best adjusted in pyqms.params (which
can be passed during isotoplogue lib initialization)</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Match results (tuple of score, scaling factor and matched peaks).<blockquote>
<div><ul class="simple">
<li><strong>score</strong> reflects the fit of the theoretical isotopologue to the
measured (both mz and intensities are compared)</li>
<li><strong>scaling factor</strong> reflects the actual amount of the molecule in the
respective spectrum. It is defined as the sum of the total measured
intensities divided by the sum of the total calculated intensities</li>
<li><strong>matched_peaks</strong> is list of tuples that contain
measured_mz, measured_i, rel_i, calculated_mz, calculated_i</li>
</ul>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p>Multiple m/z values can occur in the range of the measured precision
of every peak of the isotopologue, thus all combinations are
considered and scored. Only the best scored match is returned for
each isotopologue.</p>
</dd></dl>

<dl class="method">
<dt id="pyqms.IsotopologueLibrary.print_overview">
<code class="descname">print_overview</code><span class="sig-paren">(</span><em>formula</em>, <em>charge=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyqms.IsotopologueLibrary.print_overview" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints an overview of a given molecule or formula to the std.out</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>formula</strong> (<em>str</em>) – Either formula or molecule</li>
<li><strong>charge</strong> (<em>int</em>) – Charge of the molecule</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>For PEPTIDE and charge 1:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Chemical</span> <span class="n">formula</span> <span class="n">C</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="n">H</span><span class="p">(</span><span class="mi">53</span><span class="p">)</span><span class="n">N</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="n">O</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="p">((</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;0.000&#39;</span><span class="p">),)</span>
<span class="n">Isotope</span>                                               <span class="n">Abundance</span>
<span class="n">pos</span>      <span class="n">Mass</span>          <span class="n">m</span><span class="o">/</span><span class="n">z</span> <span class="p">[</span><span class="n">MH</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>               <span class="n">transformed</span>    <span class="n">rel</span><span class="o">.</span>
 <span class="mi">0</span>   <span class="mf">799.3599640346</span>      <span class="mf">800.4472772254</span>         <span class="mi">64799</span>  <span class="mf">1.00000000000</span>   <span class="mi">0</span>
 <span class="mi">1</span>   <span class="mf">800.3629760500</span>      <span class="mf">801.4503895421</span>         <span class="mi">26251</span>  <span class="mf">0.40511743373</span>   <span class="mi">1</span>
 <span class="mi">2</span>   <span class="mf">801.3660976813</span>      <span class="mf">802.4536114855</span>          <span class="mi">7164</span>  <span class="mf">0.11054965401</span>   <span class="mi">2</span>
 <span class="mi">3</span>   <span class="mf">802.3692029128</span>      <span class="mf">803.4568170275</span>          <span class="mi">1456</span>  <span class="mf">0.02246678414</span>   <span class="mi">3</span>
 <span class="mi">4</span>   <span class="mf">803.3720238519</span>      <span class="mf">804.4597382487</span>           <span class="mi">175</span>  <span class="mf">0.00269333156</span>   <span class="kc">None</span>
 <span class="mi">5</span>   <span class="mf">804.3753571372</span>      <span class="mf">805.4631718673</span>            <span class="mi">20</span>  <span class="mf">0.00030196503</span>   <span class="kc">None</span>
 <span class="mi">6</span>   <span class="mf">805.3752307743</span>      <span class="mf">806.4631454918</span>             <span class="mi">1</span>  <span class="mf">0.00000771671</span>   <span class="kc">None</span>
 <span class="mi">7</span>   <span class="mf">806.3796798136</span>      <span class="mf">807.4676949760</span>             <span class="mi">0</span>  <span class="mf">0.00000003640</span>   <span class="kc">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="pyqms.IsotopologueLibrary.score_matches">
<code class="descname">score_matches</code><span class="sig-paren">(</span><em>matched_peaks</em>, <em>mz_score_percentile</em><span class="sig-paren">)</span><a class="headerlink" href="#pyqms.IsotopologueLibrary.score_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Score matched peaks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>matched_peaks</strong> (<em>list of tuples</em>) – <p>List of tuples containing</p>
<ul>
<li>measured_mz (mmz)</li>
<li>measured_intensity (mi)</li>
<li>relative_intensity_of_calculated_isotopologue_peak (ri)</li>
<li>calculated_mz (cmz)</li>
<li>calculated_i (ci)</li>
</ul>
</li>
<li><strong>mz_score_percentile</strong> (<em>float</em>) – weighting of mz score</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Parameters that influence the scoring are ‘MIN_REL_PEAK_INTENSITY_FOR_MATCHING’</p>
<p><strong>Example plots</strong></p>
<p>The figure below highlights the scoring principle. Erros for m/z and
intensity values are determined and combined into the final mScore. For
each peak of the isotopologue both errors are determined and influence
the final score.</p>
<img alt="_images/scoring_principle.png" src="_images/scoring_principle.png" />
<p>Calculated intensities are scaled to match the measured value and the
deviation is calculated. The lower the intensity, the less accurate
teh actual peaks are represented. To compensate for this, the intensity
score decreases faster for large relative intensities compared to small
relative intensities. This is highlighted in the following figure.
Legend, x-axis represents the relative intensity error (measured -
theoretical intensity) and the y-axis the intensity score. Different
colors represent various relative peak intensities.</p>
<img alt="_images/Intensity_score.png" src="_images/Intensity_score.png" />
<p><strong>Scoring</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The proper display of the formulas of the next section
requires access to the Internet when browsing the HTML
documentation. The formulas are correctly embedded into the pdf of
the documentation.</p>
</div>
<p>The pyQms matching score (mScore) is based on the work of  <a class="reference external" href="http://venus.unive.it/romanaz/modstat_ba/gowdis.pdf">Gower</a> (1971)
<em>A General Coefficient of Similarity and Some of Its Properties</em>,
Biometrics (27), 857-871.
The matching and scoring is performed on the m/z values and the
intensity values independently yielding two scores, i.e.
<span class="math">\(S^{mz}\)</span> and <span class="math">\(S^{intensity}\)</span>. In both cases, each peak <span class="math">\(k\)</span> is scored,
comparing the measured value <span class="math">\(i\)</span> with the calculated value
<span class="math">\(j\)</span> (equation 1), whereas a perfect match is 1. Each peak of the
isotopologue that has a relative intensity (relative to the maximum
intensity isotope peak) <span class="math">\(r_{k}\)</span> above the matching threshold
(by default 1% of the maximum intensity isotope peak) is matched and
scored.</p>
<div class="math">
 \begin{equation}
     s^{}_{ijk} \in [0, 1]
 \end{equation}</div><p><strong>The m/z score</strong></p>
<p>For each peak <span class="math">\(k\)</span>, the m/z similarity between measured value
<span class="math">\(i\)</span> and the calculated value <span class="math">\(j\)</span> is defined as</p>
<div class="math">
 \begin{equation}
     s^{mz}_{ijk} = 1 - (\frac{\delta^{mz}_{ijk}}{\alpha})
 \end{equation}</div><p>Whereas <span class="math">\(delta^{mz}_{ijk}\)</span> the difference in ppm between measured
<span class="math">\(mz_{ik}\)</span> and calculated <span class="math">\(mz_{jk}\)</span> and <span class="math">\(\alpha\)</span>
defines the range in ppm, in which the score decreases from 1 to 0 in a
linear fashion. In principle, <span class="math">\(\alpha\)</span> is equal to the precision
of the measurement defined by the user (pyQms parameter “REL_MZ_RANGE”,
default 5 ppm, <a class="reference external" href="http://pyqms.readthedocs.io/en/latest/params.html">http://pyqms.readthedocs.io/en/latest/params.html</a>).
For example, if the difference between measured and theoretical m/z
values would be 2.5 ppm, then the <span class="math">\(s^{mz}_{ijk}\)</span> score for this
peak <span class="math">\(k\)</span> would be 0.5.</p>
<p>The total m/z score for all peaks termed <span class="math">\(S^{mz}\)</span> is the weighted
sum of all single similarity m/z scores <span class="math">\(s^{mz}_{ijk}\)</span> (equation 3).
The weighting is defined by the theoretical intensity of the peak
<span class="math">\(k\)</span> relative to the highest peak in the theoretical isotope
pattern, termed <span class="math">\(r_{k}\)</span>.</p>
<div class="math">
 \begin{equation}
      S^{mz} = \frac{\sum\limits_{}^k s^{mz}_{ijk} r_{k} }{\sum\limits_{}^k r_{k}}
 \end{equation}</div><p><strong>The intensity score</strong></p>
<p>Prior to intensity scoring, the scaling factor <span class="math">\(\sigma\)</span> is
calculated by comparing the intensities of the measured <span class="math">\(i\)</span> and
calculated <span class="math">\(j\)</span> intensities for all peaks <span class="math">\(k\)</span> within the
matching threshold (see above). This scaling factor is calculated by
dividing the weighted sum of the measured intensity by the weighted sum
of the theoretical intensities (equation 4).</p>
<div class="math">
 \begin{equation}
      \sigma = \frac{\sum\limits_{}^k intensity_{ik} r_{k} }{\sum\limits_{}^k intensity_{jk} r_{k}}
 \end{equation}</div><p>Using this scaling factor, which is equal to the abundance of the
measured molecule, one can calculate <span class="math">\(\delta^{intensity}_{ijk}\)</span>,
which is the relative intensity error between measured and theoretical
intensity for each peak <span class="math">\(k\)</span> (equation 5).</p>
<div class="math">
 \begin{equation}
      \delta^{intensity}_{ijk} = \frac{ \left|intensity_{ik} - \sigma intensity_{jk}\right|}{\sigma intensity_{jk}}
 \end{equation}</div><p>The intensity score of peak <span class="math">\(k\)</span> is then defined (equation 6).</p>
<div class="math">
 \begin{equation}
      s^{intensity}_{ijk} = 1 - (\frac{\delta^{intensity}_{ijk}}{1 - r_{k} + \epsilon })
 \end{equation}</div><p>In analogy to the m/z score (<span class="math">\(s^{mz}_{ijk}\)</span>), the denominator
defines the range in which the peak based intensity score decreases
from 1 to 0. However, in contrast to the m/z score, the intensity error
has to be weighted by the abundance of each peak (1 - <span class="math">\(r_{k}\)</span> )
as more abundant peaks can be measured more accurately than smaller
peaks. Additionally, we introduced ϵ (pyQms parameter “REL_I_RANGE”,
default 0.2), which represents the most conservative relative error
applied to the most precisely measured peak (<span class="math">\(r_{k}\)</span> = 1). Thus,
the overall relative error (denominator) will increase with lower peaks
The total intensity score <span class="math">\(S^{intensity}\)</span> is the weighted sum of
all similarity scores <span class="math">\(k\)</span> in analogy to the <span class="math">\(S^{mz}\)</span> score:</p>
<div class="math">
 \begin{equation}
     S^{intensity} = \frac{\sum\limits_{}^k s^{intensity}_{ijk} r_{k} }{\sum\limits_{}^k r_{k}}
 \end{equation}</div><p><strong>The combined final score: mScore</strong>
The final score is termed mScore and is a sum of <span class="math">\(S^{mz}\)</span> and
<span class="math">\(S^{intensity}\)</span>. However, because some machines can measure m/z
much more accurately then intensities, we introduced <span class="math">\(\xi\)</span> to
allow for flexibilities depending on the type of mass spectrometer used.
<span class="math">\(\xi\)</span> (the pyQms parameter “MZ_SCORE_PERCENTILE”, default 0.4)
is the fraction the <span class="math">\(S^{mz}\)</span> score is weighted into the sum.
Thus, the final mScore is defined as:</p>
<div class="math">
 \begin{equation}
     mScore = \xi S^{mz} + (1 - \xi) S^{intensity}
 \end{equation}</div></dd></dl>

</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="results.html" class="btn btn-neutral float-right" title="Result Class" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quick_start.html" class="btn btn-neutral" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Johannes Leufken, Anna Niehues, L. Peter Sarin, Michael Hippler, Sebastian A. Leidel and Christian Fufezan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.0-beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>