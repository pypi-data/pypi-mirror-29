

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example Scripts &mdash; pyQms 0.5.0-beta documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pyQms 0.5.0-beta documentation" href="index.html"/>
        <link rel="prev" title="Frequently asked questions" href="faq.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pyQms
          

          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="isotopologue_library.html">Isotopologue Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Result Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="chemical_composition.html">Chemical composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="unimod_mapper.html">Unimod mapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptors.html">Adaptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="params.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-and-quick-start">General and quick start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-the-bsa-example-mzml-file">Get the BSA example mzML file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parse-ident-file-and-quantify">Parse ident file and quantify</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-match-on-peak-list">Simple match on peak list</a></li>
<li class="toctree-l3"><a class="reference internal" href="#view-result-pkl-stats">View result pkl stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-the-result-class">Access the result class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-quant-summary-file">Generate quant summary file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-raw-quant-results-as-csv">Write raw quant results as csv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-results-as-mztab">Write results as mzTab</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-results-as-mztab-bsa-example">Write results as mzTab (BSA example)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-usage">Advanced usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parse-ident-file-and-quantify-with-cam">Parse ident file and quantify (with CAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-quantification-from-identification-csv-to-peptide-abundances">Complete quantification - from identification csv to peptide abundances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-plot-including-rt-borders-and-identification-information">Example plot including RT borders and identification information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-and-visualizattion">Plotting and visualizattion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plot-example-match">Plot example match</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-match-plot">Example match plot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mic-3d-plot">MIC 3D plot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-3d-plot">Example 3D plot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mic-2d-plot">MIC 2D plot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-2d-plot">Example 2D plot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#determine-m-z-and-intensity-errors">Determine m/z and intensity errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualize-errors-on-spectrum-level">Visualize errors on spectrum level</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyQms</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Example Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/example_scripts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-scripts">
<span id="id1"></span><h1>Example Scripts<a class="headerlink" href="#example-scripts" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-and-quick-start">
<h2>General and quick start<a class="headerlink" href="#general-and-quick-start" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-the-bsa-example-mzml-file">
<span id="get-bsa-file"></span><h3>Get the BSA example mzML file<a class="headerlink" href="#get-the-bsa-example-mzml-file" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="get_example_BSA_file.main">
<code class="descclassname">get_example_BSA_file.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#get_example_BSA_file.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Downloads the BSA.mzML example file also used in openMS and Ursgal.</p>
<p>This file is ideally suited for the use with the example scripts to test
pyQms.</p>
<p>Will download the BSA1.mzML to the data folder ( ../data/BSA1.mzML )</p>
<p>Usage:</p>
<blockquote>
<div>./get_example_BSA_file.py</div></blockquote>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span> <span class="k">as</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads the BSA.mzML example file also used in openMS and Ursgal.</span>

<span class="sd">    This file is ideally suited for the use with the example scripts to test</span>
<span class="sd">    pyQms.</span>

<span class="sd">    Will download the BSA1.mzML to the data folder ( ../data/BSA1.mzML )</span>

<span class="sd">    Usage:</span>

<span class="sd">        ./get_example_BSA_file.py</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mzML_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span>
        <span class="s1">&#39;data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BSA1.mzML&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mzML_file</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">http_url</span> <span class="o">=</span> <span class="s1">&#39;http://sourceforge.net/p/open-ms/code/HEAD/tree/OpenMS/share/OpenMS/examples/BSA/BSA1.mzML?format=raw&#39;</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">http_url</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1">#Win compatible</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzML_file</span><span class="p">),</span> <span class="n">basename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ooo</span><span class="p">:</span>
            <span class="n">local_filename</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
                <span class="n">http_url</span><span class="p">,</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">output_path</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                <span class="s1">&#39;{0}?format=raw&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mzML_file</span><span class="p">),</span>
                <span class="n">mzML_file</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
                <span class="s1">&#39;{0}format=raw&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mzML_file</span><span class="p">),</span>
                <span class="n">mzML_file</span>
            <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s1">&#39;Saved file as {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">mzML_file</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parse-ident-file-and-quantify">
<h3>Parse ident file and quantify<a class="headerlink" href="#parse-ident-file-and-quantify" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="parse_ident_file_and_quantify.main">
<code class="descclassname">parse_ident_file_and_quantify.</code><code class="descname">main</code><span class="sig-paren">(</span><em>ident_file=None</em>, <em>mzml_file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#parse_ident_file_and_quantify.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Script to automatically parse <a class="reference external" href="https://github.com/ursgal/ursgal">Ursgal</a> result files and quantify it via
pyQms. Please refer to Documenation of <a class="reference internal" href="adaptors.html"><span class="doc">Adaptors</span></a> for further
information.</p>
<p><a class="reference external" href="https://github.com/ursgal/ursgal">Ursgal</a> result files or files in <cite>mzTab</cite> format are read in and used for
quantification of the BSA example file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use e.g. the BSA1.mzML example file. Please download it first using
‘get_example_BSA_file.py’. Evidence files can also be found in the
data folder ‘BSA1_omssa_2_1_9_unified.csv’ or ‘BSA1_omssa_2_1_9.mztab’</p>
</div>
<p>Usage:</p>
<blockquote>
<div>./parse_ident_file_and_quantify.py &lt;ident_file&gt; &lt;mzml_file&gt;</div></blockquote>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyqms</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pymzml</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyqms.adaptors</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">ident_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mzml_file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Script to automatically parse `Ursgal`_ result files and quantify it via</span>
<span class="sd">    pyQms. Please refer to Documenation of :doc:`adaptors` for further</span>
<span class="sd">    information.</span>

<span class="sd">    `Ursgal`_ result files or files in `mzTab` format are read in and used for</span>
<span class="sd">    quantification of the BSA example file.</span>

<span class="sd">    Note:</span>

<span class="sd">        Use e.g. the BSA1.mzML example file. Please download it first using</span>
<span class="sd">        &#39;get_example_BSA_file.py&#39;. Evidence files can also be found in the</span>
<span class="sd">        data folder &#39;BSA1_omssa_2_1_9_unified.csv&#39; or &#39;BSA1_omssa_2_1_9.mztab&#39;</span>

<span class="sd">    Usage:</span>

<span class="sd">        ./parse_ident_file_and_quantify.py &lt;ident_file&gt; &lt;mzml_file&gt;</span>

<span class="sd">    .. _Ursgal:</span>
<span class="sd">        https://github.com/ursgal/ursgal</span>

<span class="sd">    .. _mzTab:</span>
<span class="sd">        http://www.psidev.info/mztab</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ident_file</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;MZTAB&#39;</span><span class="p">):</span>
        <span class="n">evidence_score_field</span>  <span class="o">=</span> <span class="s1">&#39;search_engine_score[1]&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this is the default value in the adaptor</span>
        <span class="n">evidence_score_field</span> <span class="o">=</span> <span class="s1">&#39;PEP&#39;</span>

    <span class="k">print</span><span class="p">(</span>
        <span class="s1">&#39;Evidence score field &quot;{0}&quot; will be used.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">evidence_score_field</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fixed_labels</span><span class="p">,</span> <span class="n">evidences</span><span class="p">,</span> <span class="n">molecules</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">adaptors</span><span class="o">.</span><span class="n">parse_evidence</span><span class="p">(</span>
        <span class="n">fixed_labels</span>         <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">evidence_files</span>       <span class="o">=</span> <span class="p">[</span> <span class="n">ident_file</span> <span class="p">],</span>
        <span class="n">evidence_score_field</span> <span class="o">=</span> <span class="n">evidence_score_field</span>
    <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;molecules&#39;</span>        <span class="p">:</span> <span class="n">molecules</span><span class="p">,</span>
        <span class="s1">&#39;charges&#39;</span>          <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;metabolic_labels&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;15N&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
        <span class="s1">&#39;fixed_labels&#39;</span>     <span class="p">:</span> <span class="n">fixed_labels</span><span class="p">,</span>
        <span class="s1">&#39;verbose&#39;</span>          <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;evidences&#39;</span>        <span class="p">:</span> <span class="n">evidences</span>
    <span class="p">}</span>

    <span class="n">lib</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">IsotopologueLibrary</span><span class="p">(</span> <span class="o">**</span><span class="n">params</span> <span class="p">)</span>

    <span class="n">run</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span>
        <span class="n">mzml_file</span><span class="p">,</span>
        <span class="n">extraAccessions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;MS:1000016&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;unitName&#39;</span><span class="p">])</span>
        <span class="p">],</span>
        <span class="n">obo_version</span> <span class="o">=</span> <span class="s1">&#39;1.1.0&#39;</span>
    <span class="p">)</span>
    <span class="n">out_folder</span>         <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">mzml_file_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">results</span>            <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">scan_time</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scan time&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span> <span class="p">))</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mf">60.0</span>
            <span class="c1"># convert seconds to minutes...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;ms level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">match_all</span><span class="p">(</span>
                <span class="n">mz_i_list</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">centroidedPeaks</span><span class="p">,</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">mzml_file_basename</span><span class="p">,</span>
                <span class="n">spec_id</span>   <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="n">spec_rt</span>   <span class="o">=</span> <span class="n">scan_time</span> <span class="o">/</span> <span class="n">time_div_factor</span><span class="p">,</span>
                <span class="n">results</span>   <span class="o">=</span> <span class="n">results</span>
            <span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
        <span class="n">results</span><span class="p">,</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">out_folder</span><span class="p">,</span>
                <span class="s1">&#39;{0}_pyQms_results.pkl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">mzml_file_basename</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s1">&#39;wb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">ident_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">mzml_file</span>  <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-match-on-peak-list">
<h3>Simple match on peak list<a class="headerlink" href="#simple-match-on-peak-list" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="basic_quantification_example.main">
<code class="descclassname">basic_quantification_example.</code><code class="descname">main</code><span class="sig-paren">(</span><em>mzml=None</em><span class="sig-paren">)</span><a class="headerlink" href="#basic_quantification_example.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example script as template for most basic usage of quantification using
pyQms.</p>
<p>Use spectrum 1165 of the BSA1.mzML example file. A subrange of the spectrum
from m/z 400 to 500 is used.</p>
<dl class="docutils">
<dt>Usage:</dt>
<dd>./basic_quantification_example.py</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example does not require a reader to access ms spectra, since a
simnple peak liost is used.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyqms</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span> <span class="n">mzml</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example script as template for most basic usage of quantification using</span>
<span class="sd">    pyQms.</span>

<span class="sd">    Use spectrum 1165 of the BSA1.mzML example file. A subrange of the spectrum</span>
<span class="sd">    from m/z 400 to 500 is used.</span>

<span class="sd">    Usage:</span>
<span class="sd">        ./basic_quantification_example.py</span>

<span class="sd">    Note:</span>
<span class="sd">        This example does not require a reader to access ms spectra, since a</span>
<span class="sd">        simnple peak liost is used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">peak_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">404.2492407565097</span><span class="p">,</span> <span class="mf">2652.905029296875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">405.3003310237508</span><span class="p">,</span> <span class="mf">4831.56103515625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">408.8403673369115</span><span class="p">,</span> <span class="mf">23153.7109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">409.17476109421705</span><span class="p">,</span> <span class="mf">10182.2822265625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">409.5098740355617</span><span class="p">,</span> <span class="mf">4770.97412109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">411.17196124490727</span><span class="p">,</span> <span class="mf">3454.364013671875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">413.26627826402705</span><span class="p">,</span> <span class="mf">6861.84912109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">419.3157903165357</span><span class="p">,</span> <span class="mf">90201.5625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.2440507067882</span><span class="p">,</span> <span class="mf">11098.4716796875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.31917273788645</span><span class="p">,</span> <span class="mf">22288.9140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.73825281590496</span><span class="p">,</span> <span class="mf">8159.7099609375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">421.2406187369968</span><span class="p">,</span> <span class="mf">3768.656494140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">427.3787652898548</span><span class="p">,</span> <span class="mf">5680.43212890625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">433.3316647490907</span><span class="p">,</span> <span class="mf">8430.30859375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">434.705984428002</span><span class="p">,</span> <span class="mf">25924.38671875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">435.2080179219357</span><span class="p">,</span> <span class="mf">11041.2060546875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.6708762397708</span><span class="p">,</span> <span class="mf">4081.282470703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.69049198141124</span><span class="p">,</span> <span class="mf">5107.13330078125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.6974813419733</span><span class="p">,</span> <span class="mf">9135.3125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7112735313511</span><span class="p">,</span> <span class="mf">2517650.0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7282222289076</span><span class="p">,</span> <span class="mf">5571.26025390625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7379762316008</span><span class="p">,</span> <span class="mf">5227.4033203125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.1998579474954</span><span class="p">,</span> <span class="mf">3021.341796875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.21248374593875</span><span class="p">,</span> <span class="mf">1156173.75</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.71384916266277</span><span class="p">,</span> <span class="mf">336326.96875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">445.21533524843596</span><span class="p">,</span> <span class="mf">58547.0703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">445.71700965093</span><span class="p">,</span> <span class="mf">4182.04345703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">446.1200302053469</span><span class="p">,</span> <span class="mf">93216.3359375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.09963627699824</span><span class="p">,</span> <span class="mf">3806.537109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.1169242266495</span><span class="p">,</span> <span class="mf">59846.37109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.3464079857604</span><span class="p">,</span> <span class="mf">13170.9541015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">448.11566395552086</span><span class="p">,</span> <span class="mf">9294.5107421875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">448.3500303628631</span><span class="p">,</span> <span class="mf">3213.052490234375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">452.1123280000919</span><span class="p">,</span> <span class="mf">5092.0869140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">461.1934526664677</span><span class="p">,</span> <span class="mf">4022.537353515625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">462.1463969367603</span><span class="p">,</span> <span class="mf">99732.5</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">463.14561508666384</span><span class="p">,</span> <span class="mf">24247.015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">464.1433022096936</span><span class="p">,</span> <span class="mf">20417.041015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">465.1421080732791</span><span class="p">,</span> <span class="mf">3222.4052734375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">470.1669593722212</span><span class="p">,</span> <span class="mf">8621.81640625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">475.23989190282134</span><span class="p">,</span> <span class="mf">3369.073974609375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">493.27465300375036</span><span class="p">,</span> <span class="mf">2725.885986328125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">496.0077303201583</span><span class="p">,</span> <span class="mf">8604.0830078125</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Library generation&#39;</span><span class="p">))</span>
    <span class="n">lib</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">IsotopologueLibrary</span><span class="p">(</span>
        <span class="n">molecules</span>        <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;DDSPDLPK&#39;</span> <span class="p">],</span>
        <span class="n">charges</span>          <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span> <span class="p">],</span>
        <span class="n">metabolic_labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">fixed_labels</span>     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">verbose</span>          <span class="o">=</span> <span class="bp">True</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Library generation&#39;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">match_all</span><span class="p">(</span>
        <span class="n">mz_i_list</span> <span class="o">=</span> <span class="n">peak_list</span><span class="p">,</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;BSA_test&#39;</span><span class="p">,</span>
        <span class="n">spec_id</span>   <span class="o">=</span> <span class="mi">1165</span><span class="p">,</span>
        <span class="n">spec_rt</span>   <span class="o">=</span> <span class="mf">29.10</span><span class="p">,</span>
        <span class="n">results</span>   <span class="o">=</span> <span class="bp">None</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Results summary&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">peptide</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s1">&#39;For Peptide {0} with formula {1} and charge {2} the following match could be made:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">peptide</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">charge</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Amount {0:1.2f} (scaling_factor) was detected with a matching score of {1:1.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">match</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">,</span>
                    <span class="n">match</span><span class="o">.</span><span class="n">score</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">The follwowing peaks have been matched:&#39;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">measured_mz</span><span class="p">,</span> <span class="n">measured_intensity</span><span class="p">,</span> <span class="n">relative_i</span><span class="p">,</span> <span class="n">calculated_mz</span><span class="p">,</span> <span class="n">calculated_intensity</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">peaks</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">{0:1.6f} m/z @ {1:1.2e} intensity&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">measured_mz</span><span class="p">,</span>
                        <span class="n">measured_intensity</span>
                    <span class="p">)</span>
                <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Results summary&#39;</span><span class="p">))</span>
    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="view-result-pkl-stats">
<h3>View result pkl stats<a class="headerlink" href="#view-result-pkl-stats" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="view_result_pkl_stats.main">
<code class="descclassname">view_result_pkl_stats.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#view_result_pkl_stats.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./view_result_pkl_stats.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>This script will show the stats of a result pkl file. Can be used to query
the number of quantified formulas and charge states etc.</p>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./view_result_pkl_stats.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    This script will show the stats of a result pkl file. Can be used to query</span>
<span class="sd">    the number of quantified formulas and charge states etc.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Result pkl file holds the following information:&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results_class</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s1">&#39;Number of {0: &lt;20}: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Example values (up to 5): {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="access-the-result-class">
<h3>Access the result class<a class="headerlink" href="#access-the-result-class" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="access_result_class.main">
<code class="descclassname">access_result_class.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#access_result_class.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./access_result_class.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>This script will produce a dictionary with all summed up peptide amounts.
The main idea is to show how to access the result pkl and loop over the
data structure.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since no filters (score, RT windows, etc.) are applied, this script
should not be used to estimate the actual amount of the quantified
molecules in the results pkl.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pprint</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./access_result_class.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    This script will produce a dictionary with all summed up peptide amounts.</span>
<span class="sd">    The main idea is to show how to access the result pkl and loop over the</span>
<span class="sd">    data structure.</span>

<span class="sd">    Note:</span>

<span class="sd">        Since no filters (score, RT windows, etc.) are applied, this script</span>
<span class="sd">        should not be used to estimate the actual amount of the quantified</span>
<span class="sd">        molecules in the results pkl.</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">amount_collector</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results_class</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">peptide</span> <span class="o">=</span> <span class="n">results_class</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">peptide</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">amount_collector</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">amount_collector</span><span class="p">[</span> <span class="n">peptide</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;amount&#39;</span> <span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="k">for</span> <span class="n">matched_spectrum</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">amount_collector</span><span class="p">[</span><span class="n">peptide</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">matched_spectrum</span><span class="o">.</span><span class="n">scaling_factor</span>

    <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span>
        <span class="n">amount_collector</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-quant-summary-file">
<h3>Generate quant summary file<a class="headerlink" href="#generate-quant-summary-file" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="generate_quant_summary_file.main">
<code class="descclassname">generate_quant_summary_file.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#generate_quant_summary_file.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./generate_quant_summary_file.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>This script will produce quant summary file with all according evidence
information which are stored in the result pkl file. Amounts (maxI) will be
calculated if possible.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure, an evidence lookup is provided in the results class, so that
retention time windows can be defined. Otherwise no meaningful amounts
can be calculated.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Can take very long depending on pkl size!</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./generate_quant_summary_file.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    This script will produce quant summary file with all according evidence</span>
<span class="sd">    information which are stored in the result pkl file. Amounts (maxI) will be</span>
<span class="sd">    calculated if possible.</span>

<span class="sd">    Note:</span>

<span class="sd">        Make sure, an evidence lookup is provided in the results class, so that</span>
<span class="sd">        retention time windows can be defined. Otherwise no meaningful amounts</span>
<span class="sd">        can be calculated.</span>


<span class="sd">    Warning:</span>

<span class="sd">        Can take very long depending on pkl size!</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">rt_border_tolerance</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># quant_summary_file  = &#39;{0}_quant_summary.csv&#39;.format(result_pkl)</span>
    <span class="n">quant_summary_file</span>  <span class="o">=</span> <span class="s1">&#39;{0}_quant_summary.xlsx&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">)</span>
    <span class="n">results_class</span><span class="o">.</span><span class="n">write_rt_info_file</span><span class="p">(</span>
        <span class="n">output_file</span>         <span class="o">=</span> <span class="n">quant_summary_file</span><span class="p">,</span>
        <span class="n">list_of_csvdicts</span>    <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">trivial_name_lookup</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">rt_border_tolerance</span> <span class="o">=</span> <span class="n">rt_border_tolerance</span><span class="p">,</span>
        <span class="n">update</span>              <span class="o">=</span> <span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">results_class</span><span class="o">.</span><span class="n">calc_amounts_from_rt_info_file</span><span class="p">(</span>
        <span class="n">rt_info_file</span>         <span class="o">=</span> <span class="n">quant_summary_file</span><span class="p">,</span>
        <span class="n">rt_border_tolerance</span>  <span class="o">=</span> <span class="n">rt_border_tolerance</span><span class="p">,</span>
        <span class="n">calc_amount_function</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="p">)</span>
    <span class="k">return</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-raw-quant-results-as-csv">
<h3>Write raw quant results as csv<a class="headerlink" href="#write-raw-quant-results-as-csv" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="write_raw_result_csv.main">
<code class="descclassname">write_raw_result_csv.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#write_raw_result_csv.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./write_raw_result_csv.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>Will write all results of a result pkl into a .csv file. Please refer to
Documentation of <a class="reference internal" href="results.html"><span class="doc">Result Class</span></a> for further information.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The resulting .csv files can become very large depending on the provided
pkl file!</p>
</div>
<p>Keys in csv:</p>
<blockquote>
<div><ul class="simple">
<li>Formula           : molecular formula of the molecule (str)</li>
<li>Molecule          : molecule or trivial name (str)</li>
<li>Charge            : charge of the molecule (int)</li>
<li>ScanID            : ScanID of the quantified spectrum (int)</li>
<li>Label Percentiles : Labeling percentile ( (element, enrichment in %), )</li>
<li>Amount            : the determined amount of the molecule</li>
<li>Retention Time    : retetention time of the ScanID</li>
<li>mScore            : score of the isotopologue match</li>
<li>Filename          : filename of spectrum input files</li>
</ul>
</div></blockquote>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./write_raw_result_csv.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    Will write all results of a result pkl into a .csv file. Please refer to</span>
<span class="sd">    Documentation of :doc:`results` for further information.</span>

<span class="sd">    Warning:</span>

<span class="sd">        The resulting .csv files can become very large depending on the provided</span>
<span class="sd">        pkl file!</span>

<span class="sd">    Keys in csv:</span>

<span class="sd">        * Formula           : molecular formula of the molecule (str)</span>
<span class="sd">        * Molecule          : molecule or trivial name (str)</span>
<span class="sd">        * Charge            : charge of the molecule (int)</span>
<span class="sd">        * ScanID            : ScanID of the quantified spectrum (int)</span>
<span class="sd">        * Label Percentiles : Labeling percentile ( (element, enrichment in %), )</span>
<span class="sd">        * Amount            : the determined amount of the molecule</span>
<span class="sd">        * Retention Time    : retetention time of the ScanID</span>
<span class="sd">        * mScore            : score of the isotopologue match</span>
<span class="sd">        * Filename          : filename of spectrum input files</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">results_class</span><span class="o">.</span><span class="n">write_result_csv</span><span class="p">(</span>
        <span class="n">output_file_name</span><span class="o">=</span> <span class="s1">&#39;{0}_raw_results.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">)</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-results-as-mztab">
<h3>Write results as mzTab<a class="headerlink" href="#write-results-as-mztab" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="write_mztab_result.main">
<code class="descclassname">write_mztab_result.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#write_mztab_result.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./write_mztab_results.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>Will write all results of a result pkl into a .mztab file. Please refer to
Documentation of <a class="reference internal" href="results.html"><span class="doc">Result Class</span></a> for further information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that the ouput in mzTab format is still in beta stage.
Since pyQms is a raw quantification tool, some meta data has to be
passed/set manually by the user.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./write_mztab_results.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    Will write all results of a result pkl into a .mztab file. Please refer to</span>
<span class="sd">    Documentation of :doc:`results` for further information.</span>

<span class="sd">    Note:</span>

<span class="sd">        Please note that the ouput in mzTab format is still in beta stage.</span>
<span class="sd">        Since pyQms is a raw quantification tool, some meta data has to be</span>
<span class="sd">        passed/set manually by the user.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">results_class</span><span class="o">.</span><span class="n">write_result_mztab</span><span class="p">(</span>
        <span class="n">output_file_name</span> <span class="o">=</span> <span class="s1">&#39;{0}_results.mztab&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">)</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-results-as-mztab-bsa-example">
<h3>Write results as mzTab (BSA example)<a class="headerlink" href="#write-results-as-mztab-bsa-example" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="write_BSA_mztab_results.main">
<code class="descclassname">write_BSA_mztab_results.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#write_BSA_mztab_results.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./write_mztab_results.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>Will write all results of a result pkl into a .mztab file. Please refer to
Documentation of <a class="reference internal" href="results.html"><span class="doc">Result Class</span></a> for further information.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This example script is specifically for the BSA1.mzML quantification
results, since file specific meta data is passed. Please use
‘write_mztab_results.py’ for a more general script to produce mzTab
results.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that the ouput in mzTab format is still in beta stage.
Since pyQms is a raw quantification tool, some meta data has to be
passed/set manually by the user.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./write_mztab_results.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    Will write all results of a result pkl into a .mztab file. Please refer to</span>
<span class="sd">    Documentation of :doc:`results` for further information.</span>

<span class="sd">    Warning:</span>

<span class="sd">        This example script is specifically for the BSA1.mzML quantification</span>
<span class="sd">        results, since file specific meta data is passed. Please use</span>
<span class="sd">        &#39;write_mztab_results.py&#39; for a more general script to produce mzTab</span>
<span class="sd">        results.</span>

<span class="sd">    Note:</span>

<span class="sd">        Please note that the ouput in mzTab format is still in beta stage.</span>
<span class="sd">        Since pyQms is a raw quantification tool, some meta data has to be</span>
<span class="sd">        passed/set manually by the user.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># provide meta data as lists of mztab specific formats. Pass directly</span>
    <span class="c1"># mztab correct format.</span>

    <span class="n">mztab_meta_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;protein_search_engine_score&#39;</span>   <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;psm_search_engine_score&#39;</span>       <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[MS,MS:1001475,OMSSA:evalue, ]&#39;</span><span class="p">],</span>
        <span class="s1">&#39;fixed_mod&#39;</span>                     <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[UNIMOD, UNIMOD:4, Carbamidomethyl, ]&#39;</span><span class="p">],</span>
        <span class="s1">&#39;variable_mod&#39;</span>                  <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;[UNIMOD, UNIMOD:35, Oxidation, ]&#39;</span><span class="p">],</span>
        <span class="s1">&#39;study_variable-description&#39;</span>    <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Standard BSA measurement&#39;</span><span class="p">],</span>
        <span class="s1">&#39;ms_run-location&#39;</span>               <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;BSA1.mzML&#39;</span><span class="p">],</span>

    <span class="p">}</span>

    <span class="n">results_class</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;mztab_meta_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mztab_meta_info</span>

    <span class="n">results_class</span><span class="o">.</span><span class="n">write_result_mztab</span><span class="p">(</span>
        <span class="n">output_file_name</span> <span class="o">=</span> <span class="s1">&#39;{0}_results.mztab&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">)</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="parse-ident-file-and-quantify-with-cam">
<h3>Parse ident file and quantify (with CAM)<a class="headerlink" href="#parse-ident-file-and-quantify-with-cam" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="parse_ident_file_and_quantify_with_carbamidomethylation.main">
<code class="descclassname">parse_ident_file_and_quantify_with_carbamidomethylation.</code><code class="descname">main</code><span class="sig-paren">(</span><em>ident_file=None</em>, <em>mzml_file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#parse_ident_file_and_quantify_with_carbamidomethylation.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Script to automatically parse <a class="reference external" href="https://github.com/ursgal/ursgal">Ursgal</a> result files and quantify it via
pyQms.</p>
<p>For evidence files with molecules with Caramidomethylation as fixed
modification. These mode will be stripped from the molecules. This is
important if an metabolic label (like 15N) is applied. This ensures that the
nitrogens pools of the peptides (which are 15N labeled) do not mix up with
the nitrogen pool of the Carbamidomethylation (14N since intriduced during
sample preparation). Please refer to Documenation of <a class="reference internal" href="adaptors.html"><span class="doc">Adaptors</span></a> for
further information.</p>
<p><a class="reference external" href="https://github.com/ursgal/ursgal">Ursgal</a> result files or files in <cite>mzTab</cite> format are read in and used for
quantification of the BSA example file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use e.g. the BSA1.mzML example file. Please download it first using
‘get_example_BSA_file.py’. Evidence files can also be found in the
data folder ‘BSA1_omssa_2_1_9_unified.csv’ or ‘BSA1_omssa_2_1_9.mztab’</p>
</div>
<p>Usage:</p>
<blockquote>
<div>./parse_ident_file_and_quantify_with_carbamidomethylation.py &lt;ident_file&gt; &lt;mzml_file&gt;</div></blockquote>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyqms</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pymzml</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyqms.adaptors</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">ident_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mzml_file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Script to automatically parse `Ursgal`_ result files and quantify it via</span>
<span class="sd">    pyQms.</span>

<span class="sd">    For evidence files with molecules with Caramidomethylation as fixed</span>
<span class="sd">    modification. These mode will be stripped from the molecules. This is</span>
<span class="sd">    important if an metabolic label (like 15N) is applied. This ensures that the</span>
<span class="sd">    nitrogens pools of the peptides (which are 15N labeled) do not mix up with</span>
<span class="sd">    the nitrogen pool of the Carbamidomethylation (14N since intriduced during</span>
<span class="sd">    sample preparation). Please refer to Documenation of :doc:`adaptors` for</span>
<span class="sd">    further information.</span>

<span class="sd">    `Ursgal`_ result files or files in `mzTab` format are read in and used for</span>
<span class="sd">    quantification of the BSA example file.</span>

<span class="sd">    Note:</span>

<span class="sd">        Use e.g. the BSA1.mzML example file. Please download it first using</span>
<span class="sd">        &#39;get_example_BSA_file.py&#39;. Evidence files can also be found in the</span>
<span class="sd">        data folder &#39;BSA1_omssa_2_1_9_unified.csv&#39; or &#39;BSA1_omssa_2_1_9.mztab&#39;</span>

<span class="sd">    Usage:</span>

<span class="sd">        ./parse_ident_file_and_quantify_with_carbamidomethylation.py &lt;ident_file&gt; &lt;mzml_file&gt;</span>

<span class="sd">    .. _Ursgal:</span>
<span class="sd">        https://github.com/ursgal/ursgal</span>

<span class="sd">    .. _mzTab:</span>
<span class="sd">        http://www.psidev.info/mztab</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># define the fixed label for Caramidomethyl</span>
    <span class="n">tmp_fixed_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;C&#39;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;element_composition&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;14N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                <span class="s1">&#39;evidence_mod_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Carbamidomethyl&#39;</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="n">formatted_fixed_labels</span><span class="p">,</span> <span class="n">evidence_lookup</span><span class="p">,</span> <span class="n">molecule_list</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">adaptors</span><span class="o">.</span><span class="n">parse_evidence</span><span class="p">(</span>
        <span class="n">fixed_labels</span>   <span class="o">=</span> <span class="n">tmp_fixed_labels</span><span class="p">,</span>
        <span class="n">evidence_files</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ident_file</span> <span class="p">],</span>
    <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;molecules&#39;</span>        <span class="p">:</span> <span class="n">molecule_list</span><span class="p">,</span>
        <span class="s1">&#39;charges&#39;</span>          <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;metabolic_labels&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;15N&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">]},</span>
        <span class="s1">&#39;fixed_labels&#39;</span>     <span class="p">:</span> <span class="n">formatted_fixed_labels</span><span class="p">,</span>
        <span class="s1">&#39;verbose&#39;</span>          <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;evidences&#39;</span>        <span class="p">:</span> <span class="n">evidence_lookup</span>
    <span class="p">}</span>

    <span class="n">lib</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">IsotopologueLibrary</span><span class="p">(</span> <span class="o">**</span><span class="n">params</span> <span class="p">)</span>

    <span class="n">run</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span>
        <span class="n">mzml_file</span><span class="p">,</span>
        <span class="n">extraAccessions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;MS:1000016&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;unitName&#39;</span><span class="p">])</span>
        <span class="p">],</span>
        <span class="n">obo_version</span> <span class="o">=</span> <span class="s1">&#39;1.1.0&#39;</span>
    <span class="p">)</span>
    <span class="n">out_folder</span>         <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">mzml_file_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">spec_id</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">scan_time</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MS:1000016&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span> <span class="p">))</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mf">60.0</span>
            <span class="c1"># convert seconds to minutes...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;ms level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">match_all</span><span class="p">(</span>
                <span class="n">mz_i_list</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">centroidedPeaks</span><span class="p">,</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">mzml_file_basename</span><span class="p">,</span>
                <span class="n">spec_id</span>   <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="n">spec_rt</span>   <span class="o">=</span> <span class="n">scan_time</span> <span class="o">/</span> <span class="n">time_div_factor</span><span class="p">,</span>
                <span class="n">results</span>   <span class="o">=</span> <span class="n">results</span>
            <span class="p">)</span>

    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
        <span class="n">results</span><span class="p">,</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">out_folder</span><span class="p">,</span>
                <span class="s1">&#39;{0}_pyQms_results.pkl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">mzml_file_basename</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s1">&#39;wb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">ident_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">mzml_file</span>  <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="complete-quantification-from-identification-csv-to-peptide-abundances">
<h3>Complete quantification - from identification csv to peptide abundances<a class="headerlink" href="#complete-quantification-from-identification-csv-to-peptide-abundances" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="complete_BSA_quantification.main">
<code class="descclassname">complete_BSA_quantification.</code><code class="descname">main</code><span class="sig-paren">(</span><em>ident_file=None</em>, <em>mzml_file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#complete_BSA_quantification.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Examples script to demonstrate a (example) workflow from mzML files to
peptide abundances. Will plot for every quantified peptide a matched
isotopologue chromatogram (MIC). The plots include RT windows, maximum
amount in RT window and identification RT(s).</p>
<p><a class="reference external" href="https://github.com/ursgal/ursgal">Ursgal</a> result files or files in <cite>mzTab</cite> format are read in and used for
quantification of the BSA example file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use e.g. the BSA1.mzML example file. Please download it first using
‘get_example_BSA_file.py’. Evidence files can also be found in the
data folder ‘BSA1_omssa_2_1_9_unified.csv’ or ‘BSA1_omssa_2_1_9.mztab’</p>
</div>
<p>Usage:</p>
<blockquote>
<div>./complete_BSA_quantification.py &lt;ident_file&gt; &lt;mzml_file&gt;</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">rpy2 is required for all plotting</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyqms</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pymzml</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyqms.adaptors</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">ident_file</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mzml_file</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Examples script to demonstrate a (example) workflow from mzML files to</span>
<span class="sd">    peptide abundances. Will plot for every quantified peptide a matched</span>
<span class="sd">    isotopologue chromatogram (MIC). The plots include RT windows, maximum</span>
<span class="sd">    amount in RT window and identification RT(s).</span>

<span class="sd">    `Ursgal`_ result files or files in `mzTab` format are read in and used for</span>
<span class="sd">    quantification of the BSA example file.</span>

<span class="sd">    Note:</span>

<span class="sd">        Use e.g. the BSA1.mzML example file. Please download it first using</span>
<span class="sd">        &#39;get_example_BSA_file.py&#39;. Evidence files can also be found in the</span>
<span class="sd">        data folder &#39;BSA1_omssa_2_1_9_unified.csv&#39; or &#39;BSA1_omssa_2_1_9.mztab&#39;</span>

<span class="sd">    Usage:</span>

<span class="sd">        ./complete_BSA_quantification.py &lt;ident_file&gt; &lt;mzml_file&gt;</span>

<span class="sd">    .. _Ursgal:</span>
<span class="sd">        https://github.com/ursgal/ursgal</span>

<span class="sd">    .. _mzTab:</span>
<span class="sd">        http://www.psidev.info/mztab</span>

<span class="sd">    Note:</span>
<span class="sd">        rpy2 is required for all plotting</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># define the fixed label for Carbamidomethyl</span>
    <span class="n">tmp_fixed_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;C&#39;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;element_composition&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;14N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
                <span class="s1">&#39;evidence_mod_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Carbamidomethyl&#39;</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">ident_file</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;MZTAB&#39;</span><span class="p">):</span>
        <span class="n">evidence_score_field</span>  <span class="o">=</span> <span class="s1">&#39;search_engine_score[1]&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this is the default value in the adaptor</span>
        <span class="n">evidence_score_field</span> <span class="o">=</span> <span class="s1">&#39;PEP&#39;</span>

    <span class="k">print</span><span class="p">(</span>
        <span class="s1">&#39;Evidence score field &quot;{0}&quot; will be used.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">evidence_score_field</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">formatted_fixed_labels</span><span class="p">,</span> <span class="n">evidence_lookup</span><span class="p">,</span> <span class="n">molecule_list</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">adaptors</span><span class="o">.</span><span class="n">parse_evidence</span><span class="p">(</span>
        <span class="n">fixed_labels</span>         <span class="o">=</span> <span class="n">tmp_fixed_labels</span><span class="p">,</span>
        <span class="n">evidence_files</span>       <span class="o">=</span> <span class="p">[</span> <span class="n">ident_file</span> <span class="p">],</span>
        <span class="n">evidence_score_field</span> <span class="o">=</span> <span class="n">evidence_score_field</span>
    <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;molecules&#39;</span>        <span class="p">:</span> <span class="n">molecule_list</span><span class="p">,</span>
        <span class="s1">&#39;charges&#39;</span>          <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;metabolic_labels&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;15N&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">]},</span>
        <span class="s1">&#39;fixed_labels&#39;</span>     <span class="p">:</span> <span class="n">formatted_fixed_labels</span><span class="p">,</span>
        <span class="s1">&#39;verbose&#39;</span>          <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;evidences&#39;</span>        <span class="p">:</span> <span class="n">evidence_lookup</span>
    <span class="p">}</span>

    <span class="n">lib</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">IsotopologueLibrary</span><span class="p">(</span> <span class="o">**</span><span class="n">params</span> <span class="p">)</span>

    <span class="n">run</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span>
        <span class="n">mzml_file</span><span class="p">,</span>
        <span class="n">extraAccessions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;MS:1000016&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;unitName&#39;</span><span class="p">])</span>
        <span class="p">],</span>
        <span class="n">obo_version</span> <span class="o">=</span> <span class="s1">&#39;1.1.0&#39;</span>
    <span class="p">)</span>
    <span class="n">out_folder</span>         <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">mzml_file_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mzml_file</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">spec_id</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">scan_time</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MS:1000016&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span> <span class="p">))</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mf">60.0</span>
            <span class="c1"># convert seconds to minutes...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_div_factor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;ms level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">match_all</span><span class="p">(</span>
                <span class="n">mz_i_list</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">centroidedPeaks</span><span class="p">,</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">mzml_file_basename</span><span class="p">,</span>
                <span class="n">spec_id</span>   <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="n">spec_rt</span>   <span class="o">=</span> <span class="n">scan_time</span> <span class="o">/</span> <span class="n">time_div_factor</span><span class="p">,</span>
                <span class="n">results</span>   <span class="o">=</span> <span class="n">results</span>
            <span class="p">)</span>

    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">ident_file</span><span class="p">),</span>
        <span class="s1">&#39;complete_BSA_quantification&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;All results go into folder: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_folder</span><span class="p">))</span>
    <span class="n">rt_border_tolerance</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">quant_summary_file</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">out_folder</span><span class="p">,</span>
        <span class="s1">&#39;complete_BSA_quantification_summary.xlsx&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">write_rt_info_file</span><span class="p">(</span>
        <span class="n">output_file</span>         <span class="o">=</span> <span class="n">quant_summary_file</span><span class="p">,</span>
        <span class="n">list_of_csvdicts</span>    <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">trivial_name_lookup</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">rt_border_tolerance</span> <span class="o">=</span> <span class="n">rt_border_tolerance</span><span class="p">,</span>
        <span class="n">update</span>              <span class="o">=</span> <span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">calculated_amounts</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">calc_amounts_from_rt_info_file</span><span class="p">(</span>
        <span class="n">rt_info_file</span>         <span class="o">=</span> <span class="n">quant_summary_file</span><span class="p">,</span>
        <span class="n">rt_border_tolerance</span>  <span class="o">=</span> <span class="n">rt_border_tolerance</span><span class="p">,</span>
        <span class="n">calc_amount_function</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="c1"># calc_amount_function</span>
    <span class="p">)</span>

    <span class="n">formula_charge_to_quant_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line_dict</span> <span class="ow">in</span> <span class="n">calculated_amounts</span><span class="p">:</span>
        <span class="n">formula_charge_to_quant_info</span><span class="p">[</span> <span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]))</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;rt&#39;</span>           <span class="p">:</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;max I in window (rt)&#39;</span><span class="p">],</span>
            <span class="s1">&#39;amount&#39;</span>       <span class="p">:</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;max I in window&#39;</span><span class="p">],</span>
            <span class="s1">&#39;rt start&#39;</span>     <span class="p">:</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;start (min)&#39;</span><span class="p">],</span>
            <span class="s1">&#39;rt stop&#39;</span>      <span class="p">:</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;stop (min)&#39;</span><span class="p">],</span>
            <span class="s1">&#39;evidence_rts&#39;</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formula_charge_to_quant_info</span><span class="p">[</span> <span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]))</span> <span class="p">][</span><span class="s1">&#39;evidence_rts&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ev_string</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;evidences (min)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
                <span class="n">formula_charge_to_quant_info</span><span class="p">[</span> <span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_dict</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]))</span> <span class="p">][</span><span class="s1">&#39;evidence_rts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">round</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">ev_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="p">),</span> <span class="mi">2</span> <span class="p">)</span>
                <span class="p">)</span>
    <span class="n">import_ok</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">rpy2</span>
        <span class="n">import_ok</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">import_ok</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Plotting results plot including RT windows, abundances and identifications&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">short_key</span> <span class="o">=</span> <span class="p">(</span> <span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">charge</span> <span class="p">)</span>

            <span class="n">match_list</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">out_folder</span> <span class="p">,</span>
                <span class="s1">&#39;MIC_2D_{0}_{1}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span> <span class="n">key</span><span class="o">.</span><span class="n">formula</span> <span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">graphics</span><span class="p">,</span> <span class="n">grdevices</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">init_r_plot</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

            <span class="n">ablines</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span> <span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;v&#39;</span>   <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;lty&#39;</span> <span class="p">:</span> <span class="mi">2</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;v&#39;</span>   <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt start&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;lty&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;col&#39;</span> <span class="p">:</span> <span class="s1">&#39;blue&#39;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;v&#39;</span>   <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt stop&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;lty&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;col&#39;</span> <span class="p">:</span> <span class="s1">&#39;blue&#39;</span>
                    <span class="p">},</span>
                <span class="p">]</span>
            <span class="p">}</span>

            <span class="n">additional_legends</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span> <span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;x&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;y&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;text&#39;</span> <span class="p">:</span> <span class="s1">&#39;max intensity: {0:1.3e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">],</span>
                        <span class="p">),</span>
                        <span class="s1">&#39;pos&#39;</span>  <span class="p">:</span> <span class="mi">3</span> <span class="c1"># above</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;x&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt start&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;y&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;text&#39;</span> <span class="p">:</span> <span class="s1">&#39;RT Window start&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pos&#39;</span>  <span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="c1"># right</span>
                        <span class="s1">&#39;col&#39;</span>  <span class="p">:</span> <span class="s1">&#39;blue&#39;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;x&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt stop&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;y&#39;</span>    <span class="p">:</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;text&#39;</span> <span class="p">:</span> <span class="s1">&#39;RT window stop&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pos&#39;</span>  <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1"># left,</span>
                        <span class="s1">&#39;col&#39;</span>  <span class="p">:</span> <span class="s1">&#39;blue&#39;</span>
                    <span class="p">},</span>
                <span class="p">]</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="n">evidence_rt</span> <span class="ow">in</span> <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;evidence_rts&#39;</span><span class="p">]:</span>
                <span class="n">ablines</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;v&#39;</span>   <span class="p">:</span> <span class="n">evidence_rt</span><span class="p">,</span>
                        <span class="s1">&#39;lwd&#39;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="s1">&#39;col&#39;</span> <span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="n">additional_legends</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;x&#39;</span>    <span class="p">:</span> <span class="n">evidence_rt</span><span class="p">,</span>
                        <span class="s1">&#39;y&#39;</span>    <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s1">&#39;lwd&#39;</span>  <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="s1">&#39;col&#39;</span>  <span class="p">:</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;text&#39;</span> <span class="p">:</span> <span class="s1">&#39;MS2 ident&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pos&#39;</span>  <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="s1">&#39;srt&#39;</span>  <span class="p">:</span> <span class="mi">45</span> <span class="c1"># rotate label</span>
                    <span class="p">}</span>
                <span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">plot_MICs_2D</span><span class="p">(</span>
                <span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="n">file_name</span>          <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">rt_window</span>          <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">i_transform</span>        <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">xlimits</span>            <span class="o">=</span> <span class="p">[</span>
                    <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt start&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
                    <span class="n">formula_charge_to_quant_info</span><span class="p">[</span><span class="n">short_key</span><span class="p">][</span><span class="s1">&#39;rt stop&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span>

                <span class="p">],</span>
                <span class="n">additional_legends</span> <span class="o">=</span> <span class="n">additional_legends</span><span class="p">,</span>
                <span class="n">title</span>              <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">zlimits</span>            <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                <span class="n">ablines</span>            <span class="o">=</span> <span class="n">ablines</span><span class="p">,</span>
                <span class="n">graphics</span>           <span class="o">=</span> <span class="n">graphics</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s1">&#39;Plottted {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">ident_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">mzml_file</span>  <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="example-plot-including-rt-borders-and-identification-information">
<h4>Example plot including RT borders and identification information<a class="headerlink" href="#example-plot-including-rt-borders-and-identification-information" title="Permalink to this headline">¶</a></h4>
<p>Example plot for peptide ‘DDSPDLPK’ with charge 2 in the BSA1.mzML file.</p>
<img alt="_images/complete_quantification.png" src="_images/complete_quantification.png" />
</div>
</div>
</div>
<div class="section" id="plotting-and-visualizattion">
<h2>Plotting and visualizattion<a class="headerlink" href="#plotting-and-visualizattion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="plot-example-match">
<h3>Plot example match<a class="headerlink" href="#plot-example-match" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="plot_match_examples.main">
<code class="descclassname">plot_match_examples.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#plot_match_examples.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./plot_match_examples.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>Extracts the match information and plots one example isotopologue match into
the ‘data’ folder. Uses the plot function of pymzML (<a class="reference external" href="https://pymzml.github.io/plot.html">pymzML.plot</a>). Use
this script as template for annotating spectra with match information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Plots only one high scored formula (mScore &gt;0.95) from the result pkl.
Use e.g. with the ‘BSA1.mzML_pyQms_results.pkl’ obtained from e.g.
example script parse_ident_file_and_quantify_with_carbamidomethylation.py
to get example plotting data.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pymzml.plot</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./plot_match_examples.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    Extracts the match information and plots one example isotopologue match into</span>
<span class="sd">    the &#39;data&#39; folder. Uses the plot function of pymzML (`pymzML.plot`_). Use</span>
<span class="sd">    this script as template for annotating spectra with match information.</span>

<span class="sd">    Note:</span>

<span class="sd">        Plots only one high scored formula (mScore &gt;0.95) from the result pkl.</span>
<span class="sd">        Use e.g. with the &#39;BSA1.mzML_pyQms_results.pkl&#39; obtained from e.g.</span>
<span class="sd">        example script parse_ident_file_and_quantify_with_carbamidomethylation.py</span>
<span class="sd">        to get example plotting data.</span>

<span class="sd">    .. _pymzML.plot:</span>
<span class="sd">        https://pymzml.github.io/plot.html</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">results_class</span><span class="o">.</span><span class="n">extract_results</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">Factory</span><span class="p">()</span>
            <span class="n">label_x</span>           <span class="o">=</span> <span class="p">[]</span>
            <span class="n">measured_peaks</span>    <span class="o">=</span> <span class="p">[]</span>
            <span class="n">matched_peaks</span>     <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">measured_mz</span><span class="p">,</span> <span class="n">measured_intensity</span><span class="p">,</span> <span class="n">relative_i</span><span class="p">,</span> <span class="n">calculated_mz</span><span class="p">,</span> <span class="n">calculated_intensity</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">peaks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">measured_mz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">measured_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">measured_mz</span><span class="p">,</span> <span class="n">measured_intensity</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">matched_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">calculated_mz</span><span class="p">,</span> <span class="n">calculated_intensity</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">label_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">calculated_mz</span><span class="p">,</span>
                            <span class="s1">&#39;{0:5.3f} ppm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">measured_mz</span> <span class="o">-</span> <span class="n">calculated_mz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">measured_mz</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="n">mz_only</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">measured_peaks</span> <span class="p">]</span>
            <span class="n">mz_range</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">min</span><span class="p">(</span><span class="n">mz_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">mz_only</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">]</span>
            <span class="n">peptides</span> <span class="o">=</span> <span class="n">results_class</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peptides</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">p</span><span class="o">.</span><span class="n">newPlot</span><span class="p">(</span>
                <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Formula: {0}; Peptide: {1}; Charge: {2}</span><span class="se">\n</span><span class="s1"> File: {3}; Scan: {4}; RT: {5:1.3f}</span><span class="se">\n</span><span class="s1"> Amount: {6:1.3f}; Score: {7:1.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                    <span class="n">peptides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">spec_id</span><span class="p">,</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">rt</span><span class="p">,</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">,</span>
                    <span class="n">entry</span><span class="o">.</span><span class="n">score</span>
                <span class="p">),</span>
                <span class="n">mzRange</span> <span class="o">=</span> <span class="n">mz_range</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">measured_peaks</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;sticks&#39;</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">matched_peaks</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;triangles&#39;</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">label_x</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
                <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;label_x&#39;</span>
            <span class="p">)</span>

            <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span>
                <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                <span class="s1">&#39;{0}_Peptide_{1}_Charge_{2}.xhtml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                    <span class="n">peptides</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">charge</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_name</span><span class="p">,</span>
                <span class="n">mzRange</span>  <span class="o">=</span> <span class="n">mz_range</span>
            <span class="p">)</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s1">&#39;Plotted file {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">plot_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="example-match-plot">
<h4>Example match plot<a class="headerlink" href="#example-match-plot" title="Permalink to this headline">¶</a></h4>
<img alt="_images/example_match.png" src="_images/example_match.png" />
</div>
</div>
<div class="section" id="mic-3d-plot">
<h3>MIC 3D plot<a class="headerlink" href="#mic-3d-plot" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="mic_3d_plot.main">
<code class="descclassname">mic_3d_plot.</code><code class="descname">main</code><span class="sig-paren">(</span><em>pickle_file</em><span class="sig-paren">)</span><a class="headerlink" href="#mic_3d_plot.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./mic_3d_plot.py &lt;path_to_pickled_result_class&gt;</dd>
</dl>
<p>Plots 3-dimensional matched isotope chromatograms (MICs) of pyQms
quantification results.</p>
<p>Pickled result class can contain thousands of molecules therefore this
example script stops plotting after 10 plotted MICs. Otherwise all
quantified formula-charge-filename combinations will be plotted!</p>
<p>Use e.g. the BSA data example. Download via ‘get_example_BSA_file.py’ and
quantify using ‘parse_ident_file_and_quantify_with_carbmidomethylation.py’.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Installation of R and rpy2 is required.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">rpy2</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpy2 is not installed but required for plotting, please install it and try again&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;pip3.4 install rpy2&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    usage:</span>
<span class="sd">        ./mic_3d_plot.py &lt;path_to_pickled_result_class&gt;</span>

<span class="sd">    Plots 3-dimensional matched isotope chromatograms (MICs) of pyQms</span>
<span class="sd">    quantification results.</span>

<span class="sd">    Pickled result class can contain thousands of molecules therefore this</span>
<span class="sd">    example script stops plotting after 10 plotted MICs. Otherwise all</span>
<span class="sd">    quantified formula-charge-filename combinations will be plotted!</span>

<span class="sd">    Use e.g. the BSA data example. Download via &#39;get_example_BSA_file.py&#39; and</span>
<span class="sd">    quantify using &#39;parse_ident_file_and_quantify_with_carbmidomethylation.py&#39;.</span>

<span class="sd">    Note:</span>

<span class="sd">        Installation of R and rpy2 is required.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span> <span class="n">pickle_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">),</span>
        <span class="s1">&#39;plots&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Plotting into folder: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_folder</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Result class should not hold more then 10 keys, to prevent plot overflow!</span>
<span class="sd">Will stop after 10 plots!</span>
<span class="sd">&#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="c1"># sys.exit()</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Stopping after 10 plots!&#39;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">mzml_filename</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">file_name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">mzml_filename</span><span class="p">:</span>
            <span class="n">mzml_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mzml_filename</span><span class="p">)</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">out_folder</span> <span class="p">,</span>
            <span class="s1">&#39;MIC_3D_{0}_{1}_{2}_{3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span> <span class="n">key</span><span class="o">.</span><span class="n">formula</span> <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">key</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">label_percentiles</span><span class="p">,</span>
                <span class="n">mzml_filename</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">plot_MIC_3D</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="example-3d-plot">
<h4>Example 3D plot<a class="headerlink" href="#example-3d-plot" title="Permalink to this headline">¶</a></h4>
<img alt="_images/mic_3d.png" src="_images/mic_3d.png" />
</div>
</div>
<div class="section" id="mic-2d-plot">
<h3>MIC 2D plot<a class="headerlink" href="#mic-2d-plot" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="mic_2d_plot.main">
<code class="descclassname">mic_2d_plot.</code><code class="descname">main</code><span class="sig-paren">(</span><em>pickle_file</em><span class="sig-paren">)</span><a class="headerlink" href="#mic_2d_plot.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./mic_2d_plot.py &lt;path_to_pickled_result_class&gt;</dd>
</dl>
<p>Plots 2-dimensional matched isotope chromatograms (MICs) of pyQms
quantification results.</p>
<p>Pickled result class can contain thousands of molecules therefore this
example script stops plotting after 10 plotted MICs. Otherwise all
quantified formula-charge-filename combinations will be plotted!</p>
<p>Use e.g. the BSA data example. Download via ‘get_example_BSA_file.py’ and
quantify using ‘parse_ident_file_and_quantify_with_carbmidomethylation.py’.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Installation of R and rpy2 is required.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">rpy2</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpy2 is not installed but required for plotting, please install it and try again&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;pip3.4 install rpy2&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    usage:</span>
<span class="sd">        ./mic_2d_plot.py &lt;path_to_pickled_result_class&gt;</span>

<span class="sd">    Plots 2-dimensional matched isotope chromatograms (MICs) of pyQms</span>
<span class="sd">    quantification results.</span>

<span class="sd">    Pickled result class can contain thousands of molecules therefore this</span>
<span class="sd">    example script stops plotting after 10 plotted MICs. Otherwise all</span>
<span class="sd">    quantified formula-charge-filename combinations will be plotted!</span>

<span class="sd">    Use e.g. the BSA data example. Download via &#39;get_example_BSA_file.py&#39; and</span>
<span class="sd">    quantify using &#39;parse_ident_file_and_quantify_with_carbmidomethylation.py&#39;.</span>

<span class="sd">    Note:</span>

<span class="sd">        Installation of R and rpy2 is required.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span> <span class="n">pickle_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">),</span>
        <span class="s1">&#39;plots&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Plotting into folder: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_folder</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Result class should not hold more then 10 keys, to prevent plot overflow!</span>
<span class="sd">Will stop after 10 plots!</span>
<span class="sd">&#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="c1"># sys.exit()</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Stopping after 10 plots!&#39;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">mzml_filename</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">file_name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">mzml_filename</span><span class="p">:</span>
            <span class="n">mzml_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mzml_filename</span><span class="p">)</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">out_folder</span> <span class="p">,</span>
            <span class="s1">&#39;MIC_2D_{0}_{1}_{2}_{3}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span> <span class="n">key</span><span class="o">.</span><span class="n">formula</span> <span class="p">]</span>
                <span class="p">),</span>
                <span class="n">key</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">label_percentiles</span><span class="p">,</span>
                <span class="n">mzml_filename</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">graphics</span><span class="p">,</span> <span class="n">grdevices</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">init_r_plot</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">plot_MICs_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="n">key</span><span class="p">],</span>
            <span class="n">graphics</span> <span class="o">=</span> <span class="n">graphics</span>
        <span class="p">)</span>


    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="example-2d-plot">
<h4>Example 2D plot<a class="headerlink" href="#example-2d-plot" title="Permalink to this headline">¶</a></h4>
<img alt="_images/mic_2d.png" src="_images/mic_2d.png" />
</div>
</div>
<div class="section" id="determine-m-z-and-intensity-errors">
<h3>Determine m/z and intensity errors<a class="headerlink" href="#determine-m-z-and-intensity-errors" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="determine_mz_and_i_error.main">
<code class="descclassname">determine_mz_and_i_error.</code><code class="descname">main</code><span class="sig-paren">(</span><em>result_pkl=None</em><span class="sig-paren">)</span><a class="headerlink" href="#determine_mz_and_i_error.main" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>usage:</dt>
<dd>./determine_mz_and_i_error.py &lt;Path2ResultPkl&gt;</dd>
</dl>
<p>This script will determine the apparant mz and intensity error present
in the quantifications for the given result pkl.</p>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">result_pkl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    usage:</span>
<span class="sd">        ./determine_mz_and_i_error.py &lt;Path2ResultPkl&gt;</span>

<span class="sd">    This script will determine the apparant mz and intensity error present</span>
<span class="sd">    in the quantifications for the given result pkl.</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="nb">open</span><span class="p">(</span>
            <span class="n">result_pkl</span><span class="p">,</span>
            <span class="s1">&#39;rb&#39;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">),</span>
        <span class="s1">&#39;mz_and_intesnity_error_{0}.pdf&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result_pkl</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">results_class</span><span class="o">.</span><span class="n">_determine_measured_error</span><span class="p">(</span>
        <span class="n">score_threshold</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">topX</span>            <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">filename</span>        <span class="o">=</span> <span class="n">plot_name</span><span class="p">,</span>
        <span class="n">plot</span>            <span class="o">=</span> <span class="bp">True</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span>
            <span class="n">result_pkl</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualize-errors-on-spectrum-level">
<h3>Visualize errors on spectrum level<a class="headerlink" href="#visualize-errors-on-spectrum-level" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="visualize_scoring_information.main">
<code class="descclassname">visualize_scoring_information.</code><code class="descname">main</code><span class="sig-paren">(</span><em>mzml=None</em><span class="sig-paren">)</span><a class="headerlink" href="#visualize_scoring_information.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example script fort visualizing the m/z and intensity error, which is the
basis for the scoring of the matches in pyQms.</p>
<p>Use spectrum 1165 of the BSA1.mzML example file. A subrange of the spectrum
from m/z 400 to 500 is used.</p>
<dl class="docutils">
<dt>Usage:</dt>
<dd>./visualize_scoring_information.py</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example does not require a reader to access MS spectra, since a
simnple peak list is used.</p>
</div>
</dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pyQms</span>
<span class="sd">    -----</span>

<span class="sd">    Python module for fast and accurate mass spectrometry data quantification</span>

<span class="sd">    :license: MIT, see LICENSE.txt for more details</span>

<span class="sd">    Authors:</span>

<span class="sd">        * Leufken, J.</span>
<span class="sd">        * Niehues, A.</span>
<span class="sd">        * Sarin, L.P.</span>
<span class="sd">        * Hippler, M.</span>
<span class="sd">        * Leidel, S.A.</span>
<span class="sd">        * Fufezan, C.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyqms</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">pymzml</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">ddict</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span> <span class="n">mzml</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Example script fort visualizing the m/z and intensity error, which is the</span>
<span class="sd">    basis for the scoring of the matches in pyQms.</span>

<span class="sd">    Use spectrum 1165 of the BSA1.mzML example file. A subrange of the spectrum</span>
<span class="sd">    from m/z 400 to 500 is used.</span>

<span class="sd">    Usage:</span>
<span class="sd">        ./visualize_scoring_information.py</span>

<span class="sd">    Note:</span>
<span class="sd">        This example does not require a reader to access MS spectra, since a</span>
<span class="sd">        simnple peak list is used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">peak_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">404.2492407565097</span><span class="p">,</span> <span class="mf">2652.905029296875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">405.3003310237508</span><span class="p">,</span> <span class="mf">4831.56103515625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">408.8403673369115</span><span class="p">,</span> <span class="mf">23153.7109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">409.17476109421705</span><span class="p">,</span> <span class="mf">10182.2822265625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">409.5098740355617</span><span class="p">,</span> <span class="mf">4770.97412109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">411.17196124490727</span><span class="p">,</span> <span class="mf">3454.364013671875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">413.26627826402705</span><span class="p">,</span> <span class="mf">6861.84912109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">419.3157903165357</span><span class="p">,</span> <span class="mf">90201.5625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.2440507067882</span><span class="p">,</span> <span class="mf">11098.4716796875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.31917273788645</span><span class="p">,</span> <span class="mf">22288.9140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">420.73825281590496</span><span class="p">,</span> <span class="mf">8159.7099609375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">421.2406187369968</span><span class="p">,</span> <span class="mf">3768.656494140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">427.3787652898548</span><span class="p">,</span> <span class="mf">5680.43212890625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">433.3316647490907</span><span class="p">,</span> <span class="mf">8430.30859375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">434.705984428002</span><span class="p">,</span> <span class="mf">25924.38671875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">435.2080179219357</span><span class="p">,</span> <span class="mf">11041.2060546875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.6708762397708</span><span class="p">,</span> <span class="mf">4081.282470703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.69049198141124</span><span class="p">,</span> <span class="mf">5107.13330078125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.6974813419733</span><span class="p">,</span> <span class="mf">9135.3125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7112735313511</span><span class="p">,</span> <span class="mf">2517650.0</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7282222289076</span><span class="p">,</span> <span class="mf">5571.26025390625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">443.7379762316008</span><span class="p">,</span> <span class="mf">5227.4033203125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.1998579474954</span><span class="p">,</span> <span class="mf">3021.341796875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.21248374593875</span><span class="p">,</span> <span class="mf">1156173.75</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">444.71384916266277</span><span class="p">,</span> <span class="mf">336326.96875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">445.21533524843596</span><span class="p">,</span> <span class="mf">58547.0703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">445.71700965093</span><span class="p">,</span> <span class="mf">4182.04345703125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">446.1200302053469</span><span class="p">,</span> <span class="mf">93216.3359375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.09963627699824</span><span class="p">,</span> <span class="mf">3806.537109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.1169242266495</span><span class="p">,</span> <span class="mf">59846.37109375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">447.3464079857604</span><span class="p">,</span> <span class="mf">13170.9541015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">448.11566395552086</span><span class="p">,</span> <span class="mf">9294.5107421875</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">448.3500303628631</span><span class="p">,</span> <span class="mf">3213.052490234375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">452.1123280000919</span><span class="p">,</span> <span class="mf">5092.0869140625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">461.1934526664677</span><span class="p">,</span> <span class="mf">4022.537353515625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">462.1463969367603</span><span class="p">,</span> <span class="mf">99732.5</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">463.14561508666384</span><span class="p">,</span> <span class="mf">24247.015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">464.1433022096936</span><span class="p">,</span> <span class="mf">20417.041015625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">465.1421080732791</span><span class="p">,</span> <span class="mf">3222.4052734375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">470.1669593722212</span><span class="p">,</span> <span class="mf">8621.81640625</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">475.23989190282134</span><span class="p">,</span> <span class="mf">3369.073974609375</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">493.27465300375036</span><span class="p">,</span> <span class="mf">2725.885986328125</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">496.0077303201583</span><span class="p">,</span> <span class="mf">8604.0830078125</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Library generation&#39;</span><span class="p">))</span>
    <span class="n">lib</span> <span class="o">=</span> <span class="n">pyqms</span><span class="o">.</span><span class="n">IsotopologueLibrary</span><span class="p">(</span>
        <span class="n">molecules</span>        <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;DDSPDLPK&#39;</span> <span class="p">],</span>
        <span class="n">charges</span>          <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span> <span class="p">],</span>
        <span class="n">metabolic_labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">fixed_labels</span>     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
        <span class="n">verbose</span>          <span class="o">=</span> <span class="bp">True</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{0:-^100}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Library generation&#39;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">match_all</span><span class="p">(</span>
        <span class="n">mz_i_list</span> <span class="o">=</span> <span class="n">peak_list</span><span class="p">,</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;BSA_test&#39;</span><span class="p">,</span>
        <span class="n">spec_id</span>   <span class="o">=</span> <span class="mi">1165</span><span class="p">,</span>
        <span class="n">spec_rt</span>   <span class="o">=</span> <span class="mf">29.10</span><span class="p">,</span>
        <span class="n">results</span>   <span class="o">=</span> <span class="bp">None</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">extract_results</span><span class="p">():</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pymzml</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">Factory</span><span class="p">()</span>
        <span class="n">label_mz_error</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_i_error</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">measured_peaks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matched_peaks</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">peak_info</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="c1"># pprint.pprint(entry.peaks)</span>
        <span class="k">for</span> <span class="n">measured_mz</span><span class="p">,</span> <span class="n">measured_intensity</span><span class="p">,</span> <span class="n">relative_i</span><span class="p">,</span> <span class="n">calculated_mz</span><span class="p">,</span> <span class="n">calculated_intensity</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">peaks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">measured_mz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">measured_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">measured_mz</span><span class="p">,</span>
                        <span class="n">measured_intensity</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">matched_peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">calculated_mz</span><span class="p">,</span>
                        <span class="n">calculated_intensity</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">mz_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">measured_mz</span> <span class="o">-</span> <span class="n">calculated_mz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">measured_mz</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="p">)</span>
                <span class="n">label_mz_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">calculated_mz</span><span class="p">,</span>
                        <span class="s1">&#39;{0:5.3f} ppm m/z error&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">mz_error</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">scaled_intensity</span> <span class="o">=</span> <span class="n">calculated_intensity</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span>
                <span class="n">rel_i_error</span>  <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">measured_intensity</span> <span class="o">-</span> <span class="n">scaled_intensity</span><span class="p">)</span> <span class="o">/</span> <span class="n">scaled_intensity</span>

                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;measured peaks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measured_mz</span><span class="p">)</span>
                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;theoretical peaks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculated_mz</span><span class="p">)</span>
                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;relative intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relative_i</span><span class="p">)</span>
                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;scaled matched peaks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">calculated_intensity</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="p">)</span>
                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;mz error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">mz_error</span><span class="p">)</span>
                <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;i error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">rel_i_error</span> <span class="p">)</span>


                <span class="k">if</span> <span class="n">rel_i_error</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rel_i_error</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">label_i_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">calculated_mz</span><span class="p">,</span>
                        <span class="s1">&#39;{0:5.3f} rel. intensity error&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">rel_i_error</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>



        <span class="n">mz_only</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">measured_peaks</span> <span class="p">]</span>
        <span class="n">mz_range</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">min</span><span class="p">(</span><span class="n">mz_only</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">mz_only</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">]</span>
        <span class="n">peptide</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">lookup</span><span class="p">[</span><span class="s1">&#39;formula to molecule&#39;</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">newPlot</span><span class="p">(</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Formula: {0}; Peptide: {1}; Charge: {2}</span><span class="se">\n</span><span class="s1"> Amount: {3:1.3f}; Score: {4:1.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="n">peptide</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">scaling_factor</span><span class="p">,</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">score</span>
            <span class="p">),</span>
            <span class="n">mzRange</span> <span class="o">=</span> <span class="n">mz_range</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">measured_peaks</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;sticks&#39;</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">matched_peaks</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;triangles&#39;</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">label_mz_error</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;label_x&#39;</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">label_i_error</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;label_x&#39;</span>
        <span class="p">)</span>

        <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span>
            <span class="s1">&#39;data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Score_visualization_Peptide_{1}_Charge_{2}.xhtml&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">peptide</span><span class="p">,</span>
                <span class="n">key</span><span class="o">.</span><span class="n">charge</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_name</span><span class="p">,</span>
            <span class="n">mzRange</span>  <span class="o">=</span> <span class="n">mz_range</span>
        <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span>
                <span class="s1">&#39;Plotted file {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">plot_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># print(entry)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Match info&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">peak_info</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;[{0}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">])))</span>
            <span class="k">print</span><span class="p">()</span>
    <span class="k">return</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="faq.html" class="btn btn-neutral" title="Frequently asked questions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Johannes Leufken, Anna Niehues, L. Peter Sarin, Michael Hippler, Sebastian A. Leidel and Christian Fufezan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.0-beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>