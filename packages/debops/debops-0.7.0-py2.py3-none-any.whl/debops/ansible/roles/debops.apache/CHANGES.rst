Changelog
=========

.. include:: includes/all.rst

**debops.apache**

This project adheres to `Semantic Versioning <http://semver.org/spec/v2.0.0.html>`__
and `human-readable changelog <http://keepachangelog.com/en/0.3.0/>`__.

The current role maintainer_ is ypid_.


debops.apache v0.1.0 - unreleased
---------------------------------

Added
~~~~~

- Initial coding and design. [ypid_]

- Add :envvar:`apache__redirect_to_https` to control the role's default behaviour for
  redirecting to https. [muelli_]

- Add/Set the default `Referrer Policy`_ to ``same-origin`` and made it
  configurable via :ref:`item.http_referrer_policy <apache__ref_vhost_http_referrer_policy>`.

  Note that ``no-referrer`` was originally used in an unreleased version of the
  role but this seemed to cause issues with certain applications so it was
  changed to ``same-origin`` by default. ``no-referrer`` can still be used when
  you know it does not break anything. [ypid_, drybjed_, scibi_]

- Add the :envvar:`apache__mpm_max_connections_per_child` variable to allow to
  configure the number of requests a child process should handle before
  terminating. [ypid_]

- Add support to enable and configure `Apache mod_status`_. You can set
  :envvar:`apache__status_enabled` to ``True`` to enable it and make the status
  page accessible from localhost. [ypid_]

- Add support for generic Apache template generation using the `Apache IfVersion directive`_.
  This feature can be configured by :envvar:`apache__config_use_if_version` and
  :envvar:`apache__config_min_version`. [ypid_]

- Add Ansible tags for env roles. To only prepare the Apache role
  environment, you can use the ``role::apache:env`` tag. [ypid_]

- Support to set the HTTP headers ``Content-Security-Policy`` and
  ``Content-Security-Policy-Report-Only``.
  Refer to :ref:`apache__ref_servers_http_security_headers` for details. [ypid_]

Changed
~~~~~~~

- Change default virtual host server name from ``000-default`` to ``default.{{
  apache__domain }}`` to increase the chances that a valid certificate is
  available for this virtual host (either wildcard or SAN) in order to avoid
  the warning of Apache that the certificate is not valid for the server name. [ypid_]

- Change :envvar:`apache__hsts_preload` from ``True`` to ``False`` by default.
  Setting this value to ``True`` alone does not achieve anything and can
  actually cause problems if you are not prepared.
  Thus it is disabled by default.
  If you are ready for the future of HTTPS and TLS only, you are encouraged to
  enable it! [ypid_]

Fixed
~~~~~

- Fixed usage of :envvar:`apache__dependent_packages` for ``debops.apache``.
  Previously the variable was only considered when handed to the ``debops.apache/env`` role.
  Note that all dependency variables should be passed to the main
  ``debops.apache`` role to avoid confusion. :envvar:`apache__dependent_packages` now
  only works when passed to the main role.

- Ensure that the shared object cache provider module is loaded when required
  for :envvar:`apache__ocsp_stapling_cache`. Before, the ``socache_shmcb``
  module was implicitly loaded by the ``ssl`` module. [ypid_]

- Ensure that the rewrite module is loaded when it is used by the configuration
  generated by the role. [ypid_]

- Fix ``item.https_enabled`` support for virtual hosts. This variable was
  ignored previously using the global default (``True``) directly. [ypid_]

- Fix role run with ``apache__deploy_state == "absent"`` after the role has
  been run with ``present`` before. [ypid_]

- Fix missing closing ``</IfModule>`` directive in case an old OpenSSL version
  is used. [ypid_]

- Fix an issue where ``mod_rewrite`` could not be activated after initial role
  deployment when existing configuration contained unwrapped rewrite rules.
  [drybjed_]

- Don't define HTTPS redirects for vhosts and completely disable ``mod_ssl``
  if :envvar:`apache__https_enabled` is set to ``False``. [ganto_]

- Fix usage of ``item.http_frame_options``, ``item.http_xss_protection``,
  ``item.http_referrer_policy``, ``item.http_content_type_options`` and their
  corresponding default options. [ypid_]

- Fix Ansible 2.2 deprecation warnings which requires Ansible 2.2 or higher.
  Support for older Ansible versions is dropped. [brzhk]
