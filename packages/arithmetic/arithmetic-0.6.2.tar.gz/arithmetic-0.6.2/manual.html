<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>arithmetic</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="arithmetic">
<h1 class="title">arithmetic</h1>

<!-- project.rst -->
<!--  -->
<!-- Copyright (c) 2010, 2011 Patricio Paez <pp@pp.com.mx> -->
<!--  -->
<!-- This program is free software; you can redistribute it and/or modify -->
<!-- it under the terms of the GNU General Public License as published by -->
<!-- the Free Software Foundation; either version 2 of the License, or -->
<!-- (at your option) any later version. -->
<!--  -->
<!-- This program is distributed in the hope that it will be useful, -->
<!-- but WITHOUT ANY WARRANTY; without even the implied warranty of -->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the -->
<!-- GNU General Public License for more details. -->
<!--  -->
<!-- You should have received a copy of the GNU General Public License -->
<!-- along with this program.  If not, see <http://www.gnu.org/licenses/> -->
<p><em>arithmetic</em> is a Python module that allows mixing arithmetic
operations and text.
Tk, GTK and wxWidgets based sample editors that use the module
are provided as a starting point.  A plugin for Zim and a patch for PyRoom
editors.
Tutorial documents are included, they will quickly show
all the features of arithmetic.
It is licensed under the Gnu GPL license version 2 or later.</p>
<p>The project is available at <a class="reference external" href="http://pp.com.mx/python/arithmetic">http://pp.com.mx/python/arithmetic</a></p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#download" id="id1">Download</a></li>
<li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li>
<li><a class="reference internal" href="#tutorials" id="id3">Tutorials</a></li>
<li><a class="reference internal" href="#installation" id="id4">Installation</a></li>
<li><a class="reference internal" href="#use-in-existing-graphical-applications" id="id5">Use in existing graphical applications</a></li>
<li><a class="reference internal" href="#adding-the-plugin-to-zim" id="id6">Adding the plugin to Zim</a></li>
<li><a class="reference internal" href="#applying-the-patch-to-pyroom" id="id7">Applying the patch to PyRoom</a></li>
<li><a class="reference internal" href="#how-it-works" id="id8">How it works</a></li>
</ul>
</div>
<div class="section" id="download">
<h1><a class="toc-backref" href="#id1">Download</a></h1>
<p>Download the latest arithmetic-&lt;version&gt;.tar.gz file:</p>
<pre class="literal-block">
$ wget http://pp.com.mx/python/arithmetic/arithmetic-&lt;version&gt;.tar.gz
</pre>
<p>Extract the contents:</p>
<pre class="literal-block">
$ tar xf arithmetic-&lt;version&gt;.tar.gz
</pre>
<p>Enter the folder arithmetic-&lt;version&gt; that was created:</p>
<pre class="literal-block">
$ cd arithmetic-&lt;version&gt;
</pre>
</div>
<div class="section" id="requirements">
<h1><a class="toc-backref" href="#id2">Requirements</a></h1>
<p>The <em>arithmetic</em> module uses only modules from the standard
Python library, no additional modules are required.</p>
<p>The sample
editors that are included require the Python bindings to the
graphical toolkit they use.  The following table shows which
package is required in each case:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="38%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Editor</th>
<th class="head">Package</th>
<th class="head">Python
bindings</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>editor-tk.py</td>
<td>python-tk</td>
<td>Tkinter</td>
</tr>
<tr><td>editor-gtk.py</td>
<td>python-gtk2</td>
<td>gtk</td>
</tr>
<tr><td>editor-wx.py</td>
<td>python-wxgtk2.8</td>
<td>wx</td>
</tr>
</tbody>
</table>
<p>Package <strong>python-tk</strong> might need to be installed in GNU/Linux, it is automatically
installed with Python in Windows.
Packages <strong>python-wxgtk2.8</strong> (or <em>python-wxgtk2.6</em>) and <strong>python-gtk2</strong> are
normally installed in Ubuntu Linux.</p>
</div>
<div class="section" id="tutorials">
<h1><a class="toc-backref" href="#id3">Tutorials</a></h1>
<p>There is no need to install the module in your system, if you
just want to try the module first.  Change into the source
directory before doing the following commands.  The simplest
demo is using a text file as input, the output is sent to the
standard output:</p>
<pre class="literal-block">
./arithmetic -f tutorial-1
</pre>
<p>A graphical demo of using the module in a text editor is made
using te sample editors. Open the <em>tutorial-1</em> and <em>tutorial-2</em> files
with one of the editor applications, for example in GNU/Linux, execute
the following commands in the source directory.  Using Tk:</p>
<pre class="literal-block">
./editor-tk.py tutorial-1
./editor-tk.py tutorial-2
</pre>
<p>Using GTK:</p>
<pre class="literal-block">
./editor-gtk.py tutorial-1
./editor-gtk.py tutorial-2
</pre>
<p>Using wxWidgets:</p>
<pre class="literal-block">
./editor-tk.py tutorial-1
./editor-tk.py tutorial-2
</pre>
<p>In Windows, explore the source directory and drag
each tutorial file over one of the <em>editor-*.py</em> icons.</p>
</div>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id4">Installation</a></h1>
<p>To install the module, execute as root from the source directory:</p>
<pre class="literal-block">
# python setup.py install
</pre>
<p>To install into your home directory (root user
is not required):</p>
<pre class="literal-block">
# python setup.py install --home=~
</pre>
<p>To install the Vim plugin:</p>
<pre class="literal-block">
# vim-plugin/install.sh
</pre>
</div>
<div class="section" id="use-in-existing-graphical-applications">
<h1><a class="toc-backref" href="#id5">Use in existing graphical applications</a></h1>
<p>Using arithmetic in an existing, Python-based GUI application
involves adding a <em>calculate</em> function to the application
and bind a key combination to call that function.
These are the steps in more detail:</p>
<p>1. Identify the text buffer used.  This is usually an instance
of a text widget in the graphical toolkit and can be determined
by looking at the source code.  The name of the text widget
varies on each toolkit.  The table below shows the text
buffer class name for each toolkit.</p>
<p>2. Add a binding to the <em>calculate</em> routine.  This is done
differently on each toolkit.  In some you can bind directly
to F5 for example, other toolkits any key press is bound
and you have to check for F5.</p>
<p>3. Add a <em>calculate</em> routine that will receive an event or
a reference to the text buffer.  This routine instanciates
the Parser* class for the specific toolkit and calls the
parse method that does all the work.  It scans the buffer
line by line and writes back results if needed.</p>
<p>4. Add an import statement at the begining of the
source file where <em>calculate</em> is located, to import the
appropriate class for the toolkit.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="29%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Toolkit</th>
<th class="head">Widget</th>
<th class="head">Class in arithmetic</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Tk</td>
<td>tkinter.Text</td>
<td>ParserTk</td>
</tr>
<tr><td>GTK</td>
<td>gtk.TextBuffer
(displayed
inside a
gtk.TextView
widget)</td>
<td>ParserGTK</td>
</tr>
<tr><td>wxWindows</td>
<td>wx.TextCtrl</td>
<td>ParserWx</td>
</tr>
</tbody>
</table>
<div class="section" id="tk-based-applications">
<h2>Tk-based applications</h2>
<p>Look at editor-tk.py for full detail.
The key commmands that need to be added:</p>
<pre class="literal-block">
from arithmetic import ParserTk

TextWidget.bind( '&lt;F5&gt;', calculate )

def calculate( event ):
    parser = ParserTk()
    parser.parse( event.widget )
</pre>
</div>
<div class="section" id="gtk-based-applications">
<h2>GTK-based applications</h2>
<p>Look at editor-gtk.py for full detail.
Commmands that need to be added:</p>
<pre class="literal-block">
from arithmetic import ParserGTK

def on_window1_key_press_event(self, widget, event, \*args ):
    if event.keyval == gtk.keysyms.F5:
        buf = self.textview.get_buffer()
        self.calculate(buf)

def calculate( buf ):
    parser = ParserGTK()
    parser.parse( buf )
</pre>
</div>
<div class="section" id="wxwidgets-based-applications">
<h2>wxWidgets-based applications</h2>
<p>Look at editor-wx.py for full detail.
Commmands that need to be added:</p>
<pre class="literal-block">
from arithmetic import ParserWx

self.control.Bind( wx.EVT_KEY_DOWN, calculate)

def calculate(event):
    if event.GetKeyCode() == wx.WXK_F5:
        control = event.GetEventObject()
        parser = ParserWx()
        parser.parse( control )
    event.Skip()
</pre>
</div>
</div>
<div class="section" id="adding-the-plugin-to-zim">
<h1><a class="toc-backref" href="#id6">Adding the plugin to Zim</a></h1>
<p>If you have Zim installed in your system, copy the <strong>calc.py</strong> file
to <em>/usr/local/lib/python2.6/dist-packages/zim/plugins</em>.  The 2.6 in
this path might vary depending of the Python version:</p>
<pre class="literal-block">
su -c 'cp calc.py /usr/local/lib/python2.6/dist-packages/zim/plugins'
</pre>
<p>If you just want to try Zim and arithmetic without installing any of
them, download both sources to a folder, uncompress them, change into
the zim-0.xx directory, copy the <em>calc.py</em> file into the zim/plugins
path, and run this command:</p>
<pre class="literal-block">
PYTHONPATH=../arithmetic ./zim.py
</pre>
<p>This will run Zim and tell the Python intepreter to find arithmetic in
that path instead of the default path for installed packages.  In Zim
use menu <em>Edit, Preferences</em>, then select the <em>Plugins</em> tab, look for
for the Arithmetic entry and click on it.  Check in the dependencies that
it says <em>arithmetic - OK</em>, then click on the checkbox in the <em>Enabled</em>
column to enable it.  Click on OK to close the Preferences window.  Use
menu <em>Tools</em> and verify that <em>Arithmetic  F5</em> is displayed.  You can now
write arithmetic expressions ending in a '=', then press &lt;F5&gt; to
obtain the results.</p>
</div>
<div class="section" id="applying-the-patch-to-pyroom">
<h1><a class="toc-backref" href="#id7">Applying the patch to PyRoom</a></h1>
<p>If you have PyRoom installed in your system, do the following commands
in a shell:</p>
<pre class="literal-block">
cd /usr/local/lib/python2.6/dist-packages/PyRoom
su -c 'patch -p1 pyroom-0.4.1-arithmetic.patch'
</pre>
<p>If you want to try PyRoom and arithmetic without installing them,
download both sources into a folder. uncompress them, change into
the pyroom folder and run the following command:</p>
<pre class="literal-block">
PYTHONPATH=../arithmetic ./pyroom
</pre>
<p>This runs PyRoom telling the Python interpreter to find arithmetic
in that path instead of the default path for installed packages.
Once in PyRoom, you may use <em>Control-T</em> to obtain the results from
calculations written in one of the buffers.</p>
</div>
<div class="section" id="how-it-works">
<h1><a class="toc-backref" href="#id8">How it works</a></h1>
<p>The input is a text buffer which might contain one or more
interspersed arithmetic expressions.  This buffer is scanned
line by line from top to bottom, and each line is scanned left
to right.  For each equal sign that is found, the text to the
left and to the right sides of the equals sign is parsed to
determine if it is an expression, an identifier, or empty. Based
on both sides, one of these actions is carried out:</p>
<ul class="simple">
<li>Evaluate an expression on the left side, write the result
on the right side. For example:  <em>2 + 3 =</em></li>
<li>Evaluate an expression on the right side, store the result
on the name on the left side.  For example:  width = 45</li>
<li>Store the formula for a function in the right side in the
formula name on the left side.  For example:  <em>area = width x height</em>.</li>
<li>Evaluate the value of a function on the left side, write the
result on the right side.  Like <em>area =</em>.</li>
</ul>
<p>Class <em>Parser</em> is the starting point. Its method <em>parse</em> accepts
a string representing a single or multiple line buffer, and
iterates through its lines. <em>parse</em> uses method <em>countLines</em> to
know how many lines are in the text buffer, then repeateadly
calls <em>readLine</em> to get a line and <em>parseLine</em> to scan it and
modify it if needed. <em>parse</em> returns the input string, modified
if any calculations where done.</p>
<p><em>parseLine</em> finds the equal signs and their left and right sides
and determines what action to take.  Function <em>TypeAndValueOf</em>
is used to know what is on each side (name, expression, etc.)
<em>evaluate</em>, an expression parser, is used to get results of
expressions, which may include variable or function names.  It
uses <em>WriteResults</em> to modify a part of the line to write or
update the result of an expression.</p>
<p><em>evaluate</em> uses class Lexer, a lexical analyzer, and accepts
'x' for multiplication and n%, converting it to n/100.</p>
<p>The <em>Parser</em> base class is used mostly for testing.
Classes <em>ParserTk, ParserGTK</em> and <em>ParserWx</em> are derived from Parser
and overwrite the <em>countLines, readLine</em> and <em>WriteResults</em>
methods to include toolkit-specific commands.  These are the ones
to be used for GUI applications.</p>
<p>The names and values of variables found by parseLine are stored
in the <em>variables</em> dictionary, the names and formulas of
functions are stored in the <em>functions</em> dictionary.  These
entries are read by evaluate when needed.  Both dictionaries
are initialized when the Parser* instance is created.</p>
<p>Document generated on 2018-02-09 at 20:17 CST.</p>
</div>
</div>
</body>
</html>
